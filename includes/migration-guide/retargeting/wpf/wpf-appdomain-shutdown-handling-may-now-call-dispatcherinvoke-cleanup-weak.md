---
ms.openlocfilehash: 8b804d23247b95381f3ff83bc12c32215a420fb6
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 07/01/2020
ms.locfileid: "85614609"
---
### <a name="wpf-appdomain-shutdown-handling-may-now-call-dispatcherinvoke-in-cleanup-of-weak-events"></a><span data-ttu-id="70027-101">Bei der Verarbeitung von WPF AppDomain-Herunterfahrvorgängen kann nun „Dispatcher.Invoke“ zur Bereinigung von schwachen Ereignissen aufgerufen werden</span><span class="sxs-lookup"><span data-stu-id="70027-101">WPF AppDomain Shutdown Handling May Now Call Dispatcher.Invoke in Cleanup of Weak Events</span></span>

#### <a name="details"></a><span data-ttu-id="70027-102">Details</span><span class="sxs-lookup"><span data-stu-id="70027-102">Details</span></span>

<span data-ttu-id="70027-103">In .NET Framework 4.7.1 und früheren Versionen erstellt WPF möglicherweise während des Herunterfahrens von AppDomain einen <xref:System.Windows.Threading.Dispatcher?displayProperty=nameWithType> im .NET-Finalizerthread.</span><span class="sxs-lookup"><span data-stu-id="70027-103">In .NET Framework 4.7.1 and earlier versions, WPF potentially creates a <xref:System.Windows.Threading.Dispatcher?displayProperty=nameWithType> on the .NET finalizer thread during AppDomain shutdown.</span></span>  <span data-ttu-id="70027-104">Dies wurde in .NET Framework 4.7.2 und höheren Versionen korrigiert, indem nun bei der Bereinigung von schwachen Ereignissen Threads berücksichtigt werden.</span><span class="sxs-lookup"><span data-stu-id="70027-104">This was fixed in .NET Framework 4.7.2 and later versions by making the cleanup of weak events thread-aware.</span></span>  <span data-ttu-id="70027-105">Aus diesem Grund kann WPF <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=nameWithType> aufrufen, um den Bereinigungsprozess abzuschließen. In manchen Anwendungen kann diese Änderung des Finalizerzeitpunkts zu Ausnahmen beim Herunterfahren von AppDomain oder des Prozesses führen.</span><span class="sxs-lookup"><span data-stu-id="70027-105">Due to this, WPF may call <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=nameWithType> to complete the cleanup process.In certain applications, this change in finalizer timing can potentially cause exceptions during AppDomain or process shutdown.</span></span>  <span data-ttu-id="70027-106">Dies tritt in der Regel bei Anwendungen auf, die die Verteiler, die auf Arbeitsthreads ausgeführt werden, nicht ordnungsgemäß herunterfahren, bevor der Prozess oder AppDomain heruntergefahren wird.</span><span class="sxs-lookup"><span data-stu-id="70027-106">This is generally seen in applications that do not correctly shut down dispatchers running on worker threads prior to process or AppDomain shutdown.</span></span>  <span data-ttu-id="70027-107">Bei solchen Anwendungen muss darauf geachtet werden, dass die Lebensdauer von Verteilern angemessen verwaltet wird.</span><span class="sxs-lookup"><span data-stu-id="70027-107">Such applications should take care to properly manage the lifetime of dispatchers.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="70027-108">Vorschlag</span><span class="sxs-lookup"><span data-stu-id="70027-108">Suggestion</span></span>

<span data-ttu-id="70027-109">In .NET Framework 4.7.2 und höheren Versionen können Entwickler diesen Fix deaktivieren, um Probleme bei der Zeitsteuerung zu verringern (aber nicht zu verhindern), die aufgrund der Bereinigungsänderung auftreten können. Verwenden Sie zum Deaktivieren der Bereinigungsänderung das folgende AppContext-Flag.</span><span class="sxs-lookup"><span data-stu-id="70027-109">In .NET Framework 4.7.2 and later versions, developers can disable this fix in order to help alleviate (but not eliminate) timing issues that may occur due to the cleanup change.To disable the change in cleanup, use the following AppContext flag.</span></span><pre><code class="lang-xml">&lt;configuration&gt;&#13;&#10;&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.MS.Internal.DoNotInvokeInWeakEventTableShutdownListener=true&quot;/&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;&lt;/configuration&gt;&#13;&#10;</code></pre>

| <span data-ttu-id="70027-110">name</span><span class="sxs-lookup"><span data-stu-id="70027-110">Name</span></span>    | <span data-ttu-id="70027-111">Wert</span><span class="sxs-lookup"><span data-stu-id="70027-111">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="70027-112">Bereich</span><span class="sxs-lookup"><span data-stu-id="70027-112">Scope</span></span>   | <span data-ttu-id="70027-113">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="70027-113">Edge</span></span>        |
| <span data-ttu-id="70027-114">Version</span><span class="sxs-lookup"><span data-stu-id="70027-114">Version</span></span> | <span data-ttu-id="70027-115">4.7.2</span><span class="sxs-lookup"><span data-stu-id="70027-115">4.7.2</span></span>       |
| <span data-ttu-id="70027-116">Typ</span><span class="sxs-lookup"><span data-stu-id="70027-116">Type</span></span>    | <span data-ttu-id="70027-117">Neuzuweisung</span><span class="sxs-lookup"><span data-stu-id="70027-117">Retargeting</span></span> |
