---
title: Implementieren eines Ressourcen-Managers
description: Implementieren Sie einen Resource Manager in .net. Ein Ressourcen-Manager verwaltet Ressourcen, die in Transaktionen verwendet werden. Ein Transaktions-Manager koordiniert Ressourcen-Manager-Aktionen.
ms.date: 03/30/2017
ms.assetid: d5c153f6-4419-49e3-a5f1-a50ae4c81bf3
ms.openlocfilehash: e6370f6b544255ebdc402f06b7977d4a3a587c32
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/24/2020
ms.locfileid: "91182895"
---
# <a name="implementing-a-resource-manager"></a><span data-ttu-id="2e30a-105">Implementieren eines Ressourcen-Managers</span><span class="sxs-lookup"><span data-stu-id="2e30a-105">Implementing a Resource Manager</span></span>

<span data-ttu-id="2e30a-106">Jede in einer Transaktion verwendete Ressource wird von einem Ressourcen-Manager (RM) verwaltet, dessen Aktionen von einem Transaktions-Manager (TM) koordiniert werden.</span><span class="sxs-lookup"><span data-stu-id="2e30a-106">Each resource used in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="2e30a-107">RMs arbeiten mit dem TM zusammen, um der Anwendung die Unteilbarkeit und Isolation zu garantieren.</span><span class="sxs-lookup"><span data-stu-id="2e30a-107">Resource managers work in cooperation with the transaction manager to provide the application with a guarantee of atomicity and isolation.</span></span> <span data-ttu-id="2e30a-108">Microsoft SQL Server, dauerhafte Meldungswarteschlangen und speicherinterne Hashtabellen sind Beispiele für Ressourcen-Manager.</span><span class="sxs-lookup"><span data-stu-id="2e30a-108">Microsoft SQL Server, durable message queues, in-memory hash tables are all examples of resource managers.</span></span>  
  
 <span data-ttu-id="2e30a-109">Ein RM verwaltet entweder dauerhafte oder flüchtige Daten.</span><span class="sxs-lookup"><span data-stu-id="2e30a-109">A resource manager manages either durable or volatile data.</span></span> <span data-ttu-id="2e30a-110">Die Dauerhaftigkeit (oder im Gegensatz dazu die Flüchtigkeit) eines Ressourcen-Managers leitet sich davon ab, ob der Ressourcen-Manager die Wiederherstellung nach einem Fehler unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2e30a-110">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="2e30a-111">Wenn ein RM die Wiederherstellung nach einem Fehler unterstützt, legt er Daten während Phase1 (Vorbereitung) in einem permanenten Speicher ab, damit er sich im Falle eines Ausfalls nach der Wiederherstellung erneut in die Transaktion eintragen und entsprechend den Benachrichtigungen des TM geeignete Aktionen ausführen kann.</span><span class="sxs-lookup"><span data-stu-id="2e30a-111">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the transaction manager.</span></span> <span data-ttu-id="2e30a-112">Im Allgemeinen verwalten flüchtige RMs flüchtige Ressourcen wie beispielsweise eine speicherinterne Datenstruktur (z. B. eine speicherinterne Transaktions-Hashtabelle), und dauerhafte RMs verwalten Ressourcen, die über einen beständigeren Sicherungsspeicher verfügen (z. B. eine Datenbank, deren Sicherungsspeicher ein Datenträger ist).</span><span class="sxs-lookup"><span data-stu-id="2e30a-112">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>  
  
 <span data-ttu-id="2e30a-113">Damit eine Ressource an einer Transaktion teilnehmen kann, muss sie sich in die Transaktion eintragen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-113">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="2e30a-114">Die- <xref:System.Transactions.Transaction> Klasse definiert einen Satz von Methoden, deren Namen mit **Enlist** beginnen, die diese Funktion bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-114">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="2e30a-115">Die unterschiedlichen **Enlist** -Methoden entsprechen den unterschiedlichen Arten der Eintragung, die ein Ressourcen-Manager aufweisen kann.</span><span class="sxs-lookup"><span data-stu-id="2e30a-115">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="2e30a-116">Die <xref:System.Transactions.Transaction.EnlistVolatile%2A>-Methoden werden für flüchtige Ressourcen und die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methode wird für dauerhafte Ressourcen verwendet.</span><span class="sxs-lookup"><span data-stu-id="2e30a-116">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="2e30a-117">Nachdem auf der Grundlage der Dauerhaftigkeit Ihrer Ressource entschieden wurde, ob die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methode oder die <xref:System.Transactions.Transaction.EnlistVolatile%2A>-Methode verwendet wird, sollten Sie Ihre Ressource für die Teilnahme an einem Zweiphasencommit (2PC) eintragen, indem Sie die <xref:System.Transactions.IEnlistmentNotification>-Schnittstelle für Ihren RM implementieren.</span><span class="sxs-lookup"><span data-stu-id="2e30a-117">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="2e30a-118">Weitere Informationen zu 2PC finden Sie unter [Commit a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="2e30a-118">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>  
  
 <span data-ttu-id="2e30a-119">Indem sich der RM einträgt, stellt er sicher, dass er Rückrufe des TM erhält, wenn der Transaktionscommit ausgeführt wurde oder fehlgeschlagen ist.</span><span class="sxs-lookup"><span data-stu-id="2e30a-119">By enlisting, the resource manager ensures that it gets callbacks from the transaction manager when the transaction commits or aborts.</span></span> <span data-ttu-id="2e30a-120">Es gibt eine Instanz von <xref:System.Transactions.IEnlistmentNotification> pro Eintragung.</span><span class="sxs-lookup"><span data-stu-id="2e30a-120">There is one instance of <xref:System.Transactions.IEnlistmentNotification> per enlistment.</span></span> <span data-ttu-id="2e30a-121">In der Regel gibt es eine Eintragung pro Transaktion, jedoch kann ein RM sich mehrmals in dieselbe Transaktion eintragen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-121">Typically, there is one enlistment per transaction, but a resource manager can choose to enlist multiple times in the same transaction.</span></span>  
  
 <span data-ttu-id="2e30a-122">Nach Eintragung reagiert der RM auf die Anforderungen der Transaktion.</span><span class="sxs-lookup"><span data-stu-id="2e30a-122">After enlistment, the resource manager responds to the transaction's requests.</span></span> <span data-ttu-id="2e30a-123">Ein dauerhafter RM speichert genügend Informationen, um die Änderungen einer Transaktion an den vom RM verwalteten Ressourcen rückgängig zu machen oder zu wiederholen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-123">A durable resource manager stores enough information to allow it to either undo or redo the transaction's work on resources it manages.</span></span> <span data-ttu-id="2e30a-124">Es gibt viele Wege, dies zu erreichen: Zwei gängige Verfahren sind das Aufzeichnen von Datenversionen oder das Führen eines Änderungsprotokolls.</span><span class="sxs-lookup"><span data-stu-id="2e30a-124">There are many ways to do this; keeping versions of data or keeping a log of the changes are two common techniques.</span></span>  
  
 <span data-ttu-id="2e30a-125">Wenn die Anwendung einen Commit für die Transaktion ausführt, initiiert der TM das Zweiphasencommit-Protokoll.</span><span class="sxs-lookup"><span data-stu-id="2e30a-125">When the application commits the transaction, the transaction manager initiates the two-phase commit protocol.</span></span> <span data-ttu-id="2e30a-126">Der TM fragt zuerst jeden eingetragenen RM, ob er vorbereitet ist, einen Commit für die Transaktion auszuführen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-126">The transaction manager first asks each enlisted resource manager if it is prepared to commit the transaction.</span></span> <span data-ttu-id="2e30a-127">Der RM muss sich auf den Commit vorbereiten, d. h. er bereitet sich vor, entweder einen Commit für die Transaktion auszuführen oder den Vorgang abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-127">The resource manager must prepare to commit—it readies itself to either commit or abort the transaction.</span></span>  
  
 <span data-ttu-id="2e30a-128">Während der Vorbereitungsphase erfasst der dauerhafte RM die alten und neuen Daten in einem permanenten Speicher, damit der RM sie im Falle eines Systemausfalls wiederherstellen kann.</span><span class="sxs-lookup"><span data-stu-id="2e30a-128">During the prepare phase, the durable resource manager records the old and new data in stable storage so that the resource manager can recover it even if the system fails.</span></span> <span data-ttu-id="2e30a-129">Wenn der RM die Vorbereitung vollenden konnte, informiert er den TM über seine Entscheidung, ob ein Commit für die Transaktion ausgeführt oder die Transaktion abgebrochen werden soll.</span><span class="sxs-lookup"><span data-stu-id="2e30a-129">If the resource manager can prepare, it informs the transaction manager its vote on whether to commit or abort the transaction.</span></span> <span data-ttu-id="2e30a-130">Teilt einer der RMs das Fehlschlagen der Vorbereitung mit, sendet der TM einen Rollback-Befehl an alle RMs und informiert die Anwendung über das Fehlschlagen des Commit.</span><span class="sxs-lookup"><span data-stu-id="2e30a-130">If any resource manager reports a failure to prepare, the transaction manager sends a rollback command to each resource manager and indicates the failure of the commit to the application.</span></span>  
  
 <span data-ttu-id="2e30a-131">Nach der Vorbereitung muss ein RM warten, bis er in Phase 2 einen Commit- oder Abbruchrückruf vom TM erhält.</span><span class="sxs-lookup"><span data-stu-id="2e30a-131">Once prepared, a resource manager must wait until it gets a commit or abort callback from the transaction manager in phase 2.</span></span> <span data-ttu-id="2e30a-132">In der Regel werden das gesamte Vorbereitungsprotokoll und das Commitprotokoll im Bruchteil einer Sekunde ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="2e30a-132">Typically, the entire prepare and commit protocol completes in a fraction of a second.</span></span> <span data-ttu-id="2e30a-133">Wenn es zu System- oder Kommunikationsfehlern kommt, kann es Minuten oder gar Stunden dauern, bis die Commit- oder Abbruchbenachrichtigung ankommt.</span><span class="sxs-lookup"><span data-stu-id="2e30a-133">If there are system or communication failures, the commit or abort notification may not arrive for minutes or hours.</span></span> <span data-ttu-id="2e30a-134">Während dieses Zeitraums bleibt der RM im Unklaren über das Ergebnis der Transaktion.</span><span class="sxs-lookup"><span data-stu-id="2e30a-134">During this period, the resource manager is in doubt about the outcome of the transaction.</span></span> <span data-ttu-id="2e30a-135">Er weiß nicht, ob ein Commit für die Transaktion ausgeführt oder die Transaktion abgebrochen wurde.</span><span class="sxs-lookup"><span data-stu-id="2e30a-135">It does not know whether the transaction committed or aborted.</span></span> <span data-ttu-id="2e30a-136">Während dieser Zeit der Ungewissheit, lässt der RM die Daten geändert, indem er die Transaktion sperrt. Auf diese Weise werden die Änderungen von anderen Transaktionen isoliert.</span><span class="sxs-lookup"><span data-stu-id="2e30a-136">While the resource manager is in doubt about a transaction, it keeps the data modified by keeping the transaction locked, thereby isolating these changes from any other transactions.</span></span>  
  
 <span data-ttu-id="2e30a-137">Wenn ein RM ausfällt, werden alle seine eingetragenen Transaktionen abgebrochen, ausgenommen diejenigen, die vor dem Fehler vorbereitet wurden oder deren Commit vor dem Fehler zu Ende geführt wurde.</span><span class="sxs-lookup"><span data-stu-id="2e30a-137">When a resource manager fails, all of its enlisted transactions are aborted except for those that are prepared or committed prior to the failure.</span></span> <span data-ttu-id="2e30a-138">Wenn ein dauerhafter RM neu startet, rekonstruiert er den Commitzustand der von ihm verwalteten Ressourcen, indem er die Informationen, die in der Vorbereitungsphase geschrieben wurden, abruft. Danach führt er entsprechend diesen Informationen einen Commit dieser Transaktionen aus oder bricht sie ab.</span><span class="sxs-lookup"><span data-stu-id="2e30a-138">When a durable resource manager restarts, it reconstructs the committed state of the resources it manages by retrieving the prepare information written in the prepare phase, and commits or aborts these transactions accordingly.</span></span>  
  
 <span data-ttu-id="2e30a-139">Zusammenfassend kann man sagen, dass das Zweiphasencommit-Protokoll und die RMs zusammen dafür sorgen, dass die Transaktionen unteilbar und dauerhaft sind.</span><span class="sxs-lookup"><span data-stu-id="2e30a-139">In summary, the two-phase commit protocol and the resource managers combine to make transactions atomic and durable.</span></span>  
  
 <span data-ttu-id="2e30a-140">Die <xref:System.Transactions.Transaction>-Klasse stellt die <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A>-Methode auch bereit, um eine Erweiterbare Einphaseneintragung (PSPE) vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-140">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="2e30a-141">Dadurch wird es einem dauerhaften RM ermöglicht, eine Transaktion zu hosten und zu "besitzen", die später bei Bedarf eskaliert werden kann, um von MSDTC verwaltet zu werden.</span><span class="sxs-lookup"><span data-stu-id="2e30a-141">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="2e30a-142">Weitere Informationen hierzu finden [Sie unter Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="2e30a-142">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="2e30a-143">In diesem Abschnitt</span><span class="sxs-lookup"><span data-stu-id="2e30a-143">In This Section</span></span>  

 <span data-ttu-id="2e30a-144">Die gewöhnlich von einem Ressourcen-Manager ausgeführten Schritte werden in den folgenden Themen umrissen.</span><span class="sxs-lookup"><span data-stu-id="2e30a-144">The steps generally followed by a resource manager are outlined in the following topics.</span></span>  
  
 [<span data-ttu-id="2e30a-145">Eintragen von Ressourcen als Teilnehmer an einer Transaktion</span><span class="sxs-lookup"><span data-stu-id="2e30a-145">Enlisting Resources as Participants in a Transaction</span></span>](enlisting-resources-as-participants-in-a-transaction.md)  
  
 <span data-ttu-id="2e30a-146">Beschreibt, wie eine dauerhafte oder flüchtige Ressource sich in eine Transaktion eintragen kann.</span><span class="sxs-lookup"><span data-stu-id="2e30a-146">Describes how a durable or volatile resource can enlist in a transaction.</span></span>  
  
 [<span data-ttu-id="2e30a-147">Ausführen eines Einphasen- oder Mehrphasencommits für eine Transaktion</span><span class="sxs-lookup"><span data-stu-id="2e30a-147">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](committing-a-transaction-in-single-phase-and-multi-phase.md)  
  
 <span data-ttu-id="2e30a-148">Beschreibt, wie ein Ressourcen-Manager auf eine Commitbenachrichtigung reagiert und den Commit vorbereitet.</span><span class="sxs-lookup"><span data-stu-id="2e30a-148">Describes how a resource manager responds to commit notification and prepare the commit.</span></span>  
  
 [<span data-ttu-id="2e30a-149">Durchführen einer Wiederherstellung</span><span class="sxs-lookup"><span data-stu-id="2e30a-149">Performing Recovery</span></span>](performing-recovery.md)  
  
 <span data-ttu-id="2e30a-150">Beschreibt, wie ein dauerhafter Ressourcen-Manager nach einem Fehler die Wiederherstellung durchführt.</span><span class="sxs-lookup"><span data-stu-id="2e30a-150">Describes how a durable resource manager recovers from failure.</span></span>  
  
 [<span data-ttu-id="2e30a-151">Vertrauensebenen für Sicherheit beim Zugriff auf Ressourcen</span><span class="sxs-lookup"><span data-stu-id="2e30a-151">Security Trust Levels in Accessing Resources</span></span>](security-trust-levels-in-accessing-resources.md)  
  
 <span data-ttu-id="2e30a-152">Beschreibt, wie die drei Vertrauensebenen für System.Transactions den Zugriff auf die Typen von Ressourcen einschränkt, die <xref:System.Transactions> verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="2e30a-152">Describes how the three levels of trust for System.Transactions restrict access on the types of resources that <xref:System.Transactions> exposes.</span></span>  
  
 [<span data-ttu-id="2e30a-153">Optimierung mit Einphasencommit und Heraufstufbarer Einphasenbenachrichtigung</span><span class="sxs-lookup"><span data-stu-id="2e30a-153">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](optimization-spc-and-promotable-spn.md)  
  
 <span data-ttu-id="2e30a-154">Beschreibt Optimierungsvorgehensweisen für die Implementierung von Ressourcen-Managern.</span><span class="sxs-lookup"><span data-stu-id="2e30a-154">Describes optimization practices available to implementations of resource managers.</span></span>
