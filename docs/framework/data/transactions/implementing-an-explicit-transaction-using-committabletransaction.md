---
title: Implementieren einer expliziten Transaktion mit CommittableTransaction
description: Implementieren Sie mithilfe der CommittableTransaction-Klasse in .net eine explizite Transaktion. Diese Klasse stellte Anwendungen eine explizite Möglichkeit bereit, eine Transaktion zu verwenden.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 29efe5e5-897b-46c2-a35f-e599a273acc8
ms.openlocfilehash: 7e1d78b581fcb3c4b2265f1d04cf2aba83faa28a
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/24/2020
ms.locfileid: "91182882"
---
# <a name="implementing-an-explicit-transaction-using-committabletransaction"></a><span data-ttu-id="aa96e-104">Implementieren einer expliziten Transaktion mit CommittableTransaction</span><span class="sxs-lookup"><span data-stu-id="aa96e-104">Implementing an Explicit Transaction using CommittableTransaction</span></span>

<span data-ttu-id="aa96e-105">Die <xref:System.Transactions.CommittableTransaction>-Klasse ermöglicht es Anwendungen, Transaktionen explizit zu verwenden, anstatt die <xref:System.Transactions.TransactionScope>-Klasse implizit zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="aa96e-105">The <xref:System.Transactions.CommittableTransaction> class provides an explicit way for applications to use a transaction, as opposed to using the <xref:System.Transactions.TransactionScope> class implicitly.</span></span> <span data-ttu-id="aa96e-106">Sie ist für Anwendungen nützlich, die dieselben Transaktionen über mehrere Funktionsaufrufe oder mehrere Threadaufrufe hinweg verwenden wollen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-106">It is useful for applications that want to use the same transaction across multiple function calls or multiple thread calls.</span></span> <span data-ttu-id="aa96e-107">Im Unterschied zur <xref:System.Transactions.TransactionScope>-Klasse muss der Autor der Anwendung die <xref:System.Transactions.CommittableTransaction.Commit%2A>-Methode bzw. die <xref:System.Transactions.Transaction.Rollback%2A>-Methode aufrufen, um einen Commit der Transaktion auszuführen oder um sie abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-107">Unlike the <xref:System.Transactions.TransactionScope> class, the application writer needs to specifically call the <xref:System.Transactions.CommittableTransaction.Commit%2A> and <xref:System.Transactions.Transaction.Rollback%2A> methods in order to commit or abort the transaction.</span></span>  
  
## <a name="overview-of-the-committabletransaction-class"></a><span data-ttu-id="aa96e-108">Übersicht über die CommittableTransaction-Klasse</span><span class="sxs-lookup"><span data-stu-id="aa96e-108">Overview of the CommittableTransaction class</span></span>  

 <span data-ttu-id="aa96e-109">Die <xref:System.Transactions.CommittableTransaction>-Klasse ist von der <xref:System.Transactions.Transaction>-Klasse abgeleitet und stellt deshalb die gesamte Funktionalität der letztgenannten bereit.</span><span class="sxs-lookup"><span data-stu-id="aa96e-109">The <xref:System.Transactions.CommittableTransaction> class derives from the <xref:System.Transactions.Transaction> class, therefore providing all the functionality of the latter.</span></span> <span data-ttu-id="aa96e-110">Besonders nützlich ist die <xref:System.Transactions.Transaction.Rollback%2A>-Methode für die <xref:System.Transactions.Transaction>-Klasse, die auch dazu verwendet werden kann, ein Rollback für ein <xref:System.Transactions.CommittableTransaction>-Objekt auszuführen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-110">Specifically useful is the <xref:System.Transactions.Transaction.Rollback%2A> method on the <xref:System.Transactions.Transaction> class that can also be used to rollback a <xref:System.Transactions.CommittableTransaction> object.</span></span>  
  
 <span data-ttu-id="aa96e-111">Die <xref:System.Transactions.Transaction>-Klasse ist der <xref:System.Transactions.CommittableTransaction>-Klasse ähnlich, bietet aber keine `Commit`-Methode.</span><span class="sxs-lookup"><span data-stu-id="aa96e-111">The  <xref:System.Transactions.Transaction> class is similar to the <xref:System.Transactions.CommittableTransaction> class but does not offer a `Commit` method.</span></span> <span data-ttu-id="aa96e-112">Dadurch haben Sie die Möglichkeit, das Transaktionsobjekt (oder Klone davon) an andere Methoden zu übergeben (eventuell solche anderer Threads), während Sie weiter steuern können, wann ein Commit für die Transaktion ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="aa96e-112">This enables you to pass the transaction object (or clones of it) to other methods (potentially on other threads) while still controlling when the transaction is committed.</span></span> <span data-ttu-id="aa96e-113">Der abgerufene Code kann sich für eine Transaktion eintragen und über sie abstimmen, jedoch kann nur der Ersteller des <xref:System.Transactions.CommittableTransaction>-Objekts ein Commit für die Transaktion ausführen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-113">The called code is able to enlist and vote on the transaction, but only the creator of the <xref:System.Transactions.CommittableTransaction> object has the ability to commit the transaction.</span></span>  
  
 <span data-ttu-id="aa96e-114">Berücksichtigen Sie die folgenden Aspekte, wenn Sie die <xref:System.Transactions.CommittableTransaction>-Klasse verwenden.</span><span class="sxs-lookup"><span data-stu-id="aa96e-114">You should note the followings when working with the <xref:System.Transactions.CommittableTransaction> class,</span></span>  
  
- <span data-ttu-id="aa96e-115">Durch das Erstellen einer <xref:System.Transactions.CommittableTransaction>-Transaktion wird die Ambient-Transaktion nicht festgelegt.</span><span class="sxs-lookup"><span data-stu-id="aa96e-115">Creating a <xref:System.Transactions.CommittableTransaction> transaction does not set the ambient transaction.</span></span> <span data-ttu-id="aa96e-116">Sie müssen die Ambient-Transaktion explizit festlegen und zurücksetzen, um sicherzustellen, dass Ressourcen-Manager im richtigen Transaktionskontext arbeiten.</span><span class="sxs-lookup"><span data-stu-id="aa96e-116">You need to specifically set and reset the ambient transaction, to ensure that resource managers operate under the right transaction context when appropriate.</span></span> <span data-ttu-id="aa96e-117">Die aktuelle Ambient-Transaktion wird durch Einstellen der statischen <xref:System.Transactions.Transaction.Current%2A>-Eigenschaft für das globale <xref:System.Transactions.Transaction>-Objekt festgelegt.</span><span class="sxs-lookup"><span data-stu-id="aa96e-117">The way to set the current ambient transaction is by setting the static <xref:System.Transactions.Transaction.Current%2A> property on the global <xref:System.Transactions.Transaction> object.</span></span>  
  
- <span data-ttu-id="aa96e-118">Ein <xref:System.Transactions.CommittableTransaction>-Objekt kann nicht wiederverwendet werden.</span><span class="sxs-lookup"><span data-stu-id="aa96e-118">A <xref:System.Transactions.CommittableTransaction> object cannot be reused.</span></span> <span data-ttu-id="aa96e-119">Nachdem ein Commit oder ein Rollback für ein <xref:System.Transactions.CommittableTransaction>-Objekt ausgeführt wurde, kann es nicht in einer Transaktion wiederverwendet werden.</span><span class="sxs-lookup"><span data-stu-id="aa96e-119">Once a <xref:System.Transactions.CommittableTransaction> object has been committed or rolled back, it cannot be used again in a transaction.</span></span> <span data-ttu-id="aa96e-120">Das heißt, es kann nicht als aktueller Ambient-Transaktionskontext festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="aa96e-120">That is, it cannot be set as the current ambient transaction context.</span></span>  
  
## <a name="creating-a-committabletransaction"></a><span data-ttu-id="aa96e-121">Erstellen einer CommittableTransaction</span><span class="sxs-lookup"><span data-stu-id="aa96e-121">Creating a CommittableTransaction</span></span>  

 <span data-ttu-id="aa96e-122">Im folgenden Beispiel wird eine neue Instanz von <xref:System.Transactions.CommittableTransaction> erstellt und ein Commit dafür ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="aa96e-122">The following sample creates a new <xref:System.Transactions.CommittableTransaction> and commits it.</span></span>  
  
 [!code-csharp[Tx_CommittableTx#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_committabletx/cs/committabletxwithsql.cs#1)]
 [!code-vb[Tx_CommittableTx#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_committabletx/vb/committabletxwithsql.vb#1)]  
  
 <span data-ttu-id="aa96e-123">Durch das Erstellen einer Instanz von <xref:System.Transactions.CommittableTransaction> wird der Ambient-Transaktionskontext nicht automatisch festgelegt.</span><span class="sxs-lookup"><span data-stu-id="aa96e-123">Creating an instance of <xref:System.Transactions.CommittableTransaction> does not automatically set the ambient transaction context.</span></span> <span data-ttu-id="aa96e-124">Deshalb sind Vorgänge, die für einen Ressourcen-Manager ausgeführt werden, nicht Teil dieser Transaktion.</span><span class="sxs-lookup"><span data-stu-id="aa96e-124">Therefore, any operation on a resource manager is not part of that transaction.</span></span> <span data-ttu-id="aa96e-125">Die statische <xref:System.Transactions.Transaction.Current%2A>-Eigenschaft für das globale <xref:System.Transactions.Transaction>-Objekt wird dazu verwendet, die Ambient-Transaktion festzulegen oder abzurufen. Die Anwendung muss sie manuell einstellen, um sicherzustellen, dass Ressourcen-Manager an der Transaktion teilnehmen können.</span><span class="sxs-lookup"><span data-stu-id="aa96e-125">The static <xref:System.Transactions.Transaction.Current%2A> property on the global <xref:System.Transactions.Transaction> object is used to set or retrieve the ambient transaction and the application must manually set it to ensure that resource managers can participate in the transaction.</span></span> <span data-ttu-id="aa96e-126">Es wird zudem empfohlen, die alte Ambient-Transaktion zu speichern und nach Beendigung aller Vorgänge mit dem <xref:System.Transactions.CommittableTransaction>-Objekt wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-126">It is also a good practice to save the old ambient transaction and restore it when you finish using the <xref:System.Transactions.CommittableTransaction> object.</span></span>  
  
 <span data-ttu-id="aa96e-127">Um ein Commit der Transaktion auszuführen, müssen Sie die <xref:System.Transactions.CommittableTransaction.Commit%2A>-Methode explizit aufrufen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-127">To commit the transaction, you need to explicitly call the <xref:System.Transactions.CommittableTransaction.Commit%2A> method.</span></span> <span data-ttu-id="aa96e-128">Um ein Rollback einer Transaktion auszuführen, müssen Sie die <xref:System.Transactions.Transaction.Rollback%2A>-Methode aufrufen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-128">For rolling back a transaction, you should call the <xref:System.Transactions.Transaction.Rollback%2A> method.</span></span> <span data-ttu-id="aa96e-129">Beachten Sie, dass alle Ressourcen, die von einer Transaktion betroffen sind, gesperrt bleiben, bis ein Commit oder ein Rollback für eine <xref:System.Transactions.CommittableTransaction> ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="aa96e-129">It is important to note that until a <xref:System.Transactions.CommittableTransaction> has been committed or rolled back, all the resources involved in that transaction are still locked.</span></span>  
  
 <span data-ttu-id="aa96e-130">Ein <xref:System.Transactions.CommittableTransaction>-Objekt kann über Funktionsaufrufe und Threads hinweg verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="aa96e-130">A <xref:System.Transactions.CommittableTransaction> object can be used across function calls and threads.</span></span> <span data-ttu-id="aa96e-131">Jedoch muss der Anwendungsentwickler Ausnahmen bearbeiten und die <xref:System.Transactions.Transaction.Rollback%28System.Exception%29>-Methode beim Auftreten von Fehlern explizit aufrufen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-131">However, it is up to the application developer to handle exceptions and specifically call the <xref:System.Transactions.Transaction.Rollback%28System.Exception%29> method in case of failures.</span></span>  
  
## <a name="asynchronous-commit"></a><span data-ttu-id="aa96e-132">Asynchroner Commit</span><span class="sxs-lookup"><span data-stu-id="aa96e-132">Asynchronous Commit</span></span>  

 <span data-ttu-id="aa96e-133">Die <xref:System.Transactions.CommittableTransaction>-Klasse stellt zudem einen Mechanismus bereit, um ein Commit für eine Transaktion asynchron auszuführen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-133">The <xref:System.Transactions.CommittableTransaction> class also provides a mechanism for committing a transaction asynchronously.</span></span> <span data-ttu-id="aa96e-134">Ein Transaktionscommit kann viel Zeit in Anspruch nehmen, da eventuell mehrfach auf Datenbanken zugegriffen werden muss. Außerdem bestehen im Netzwerk möglicherweise Wartezeiten aufgrund der Netzwerklatenz.</span><span class="sxs-lookup"><span data-stu-id="aa96e-134">A transaction commit can take substantial time, as it might involve multiple database access and possible network latency.</span></span> <span data-ttu-id="aa96e-135">Wenn Sie Deadlocks in Anwendungen mit hohem Durchsatz vermeiden möchten, können Sie einen asynchronen Commit durchführen, um die Transaktionsaufgaben so schnell wie möglich abzuschließen, und den Commitvorgang als Hintergrundaufgabe ausführen.</span><span class="sxs-lookup"><span data-stu-id="aa96e-135">When you want to avoid deadlocks in high throughput applications, you can use asynchronous commit to finish the transactional work as soon as possible, and run the commit operation as a background task.</span></span> <span data-ttu-id="aa96e-136">Die <xref:System.Transactions.CommittableTransaction.BeginCommit%2A>-Methode und die <xref:System.Transactions.CommittableTransaction.EndCommit%2A>-Methode der <xref:System.Transactions.CommittableTransaction>-Klasse ermöglichen dies.</span><span class="sxs-lookup"><span data-stu-id="aa96e-136">The <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> and <xref:System.Transactions.CommittableTransaction.EndCommit%2A> methods of the <xref:System.Transactions.CommittableTransaction> class allow you to do so.</span></span>  
  
 <span data-ttu-id="aa96e-137">Sie können <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> aufrufen, um den zurückgehaltenen Commit an einen Thread aus dem Threadpool weiterzuleiten.</span><span class="sxs-lookup"><span data-stu-id="aa96e-137">You can call <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> to dispatch the commit holdup to a thread from the thread pool.</span></span> <span data-ttu-id="aa96e-138">Sie können zudem <xref:System.Transactions.CommittableTransaction.EndCommit%2A> aufrufen, um zu ermitteln, ob ein Commit für die Transaktion ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="aa96e-138">You can also call <xref:System.Transactions.CommittableTransaction.EndCommit%2A> to determine if the transaction has actually been committed.</span></span> <span data-ttu-id="aa96e-139">Wenn der Commit aus irgendeinem Grund nicht für die Transaktion ausgeführt wurde, löst <xref:System.Transactions.CommittableTransaction.EndCommit%2A> eine Transaktionsausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="aa96e-139">If the transaction failed to commit for whatever reason, <xref:System.Transactions.CommittableTransaction.EndCommit%2A> raises a transaction exception.</span></span> <span data-ttu-id="aa96e-140">Wurde der Transaktionscommit zum Zeitpunkt des Aufrufs von <xref:System.Transactions.CommittableTransaction.EndCommit%2A> noch nicht ausgeführt, wird der Aufrufer gesperrt, bis der Commit durchgeführt oder die Transaktion abgebrochen wurde.</span><span class="sxs-lookup"><span data-stu-id="aa96e-140">If the transaction is not yet committed by the time <xref:System.Transactions.CommittableTransaction.EndCommit%2A> is called, the caller is blocked until the transaction is committed or aborted.</span></span>  
  
 <span data-ttu-id="aa96e-141">Das einfachste Verfahren, einen asynchronen Commit auszuführen, besteht darin, eine Rückrufmethode einzurichten. Dann erfolgt bei Beendigung des Commit ein Rückruf.</span><span class="sxs-lookup"><span data-stu-id="aa96e-141">The easiest way to do an asynchronous commit is by providing a callback method, to be called when committing is finished.</span></span> <span data-ttu-id="aa96e-142">Jedoch müssen Sie die <xref:System.Transactions.CommittableTransaction.EndCommit%2A>-Methode für das ursprüngliche <xref:System.Transactions.CommittableTransaction>-Objekt aufrufen, das für den Aufruf verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="aa96e-142">However, you must call the <xref:System.Transactions.CommittableTransaction.EndCommit%2A> method on the original <xref:System.Transactions.CommittableTransaction> object used to invoke the call.</span></span> <span data-ttu-id="aa96e-143">Um dieses Objekt zu erhalten, können Sie den *iasynkresult* -Parameter der Rückruf Methode herabsetzen, da die-Klasse die- <xref:System.Transactions.CommittableTransaction> <xref:System.IAsyncResult> Klasse implementiert.</span><span class="sxs-lookup"><span data-stu-id="aa96e-143">To obtain that object, you can downcast the *IAsyncResult* parameter of the callback method, since the <xref:System.Transactions.CommittableTransaction> class implements <xref:System.IAsyncResult> class.</span></span>  
  
 <span data-ttu-id="aa96e-144">Das folgende Beispiel zeigt, wie ein asynchroner Commit ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="aa96e-144">The following example shows how an asynchronous commit can be done.</span></span>  
  
```csharp  
public void DoTransactionalWork()  
{  
     Transaction oldAmbient = Transaction.Current;  
     CommittableTransaction committableTransaction = new CommittableTransaction();  
     Transaction.Current = committableTransaction;  
  
     try  
     {  
          /* Perform transactional work here */  
          // No errors - commit transaction asynchronously  
          committableTransaction.BeginCommit(OnCommitted,null);  
     }  
     finally  
     {  
          //Restore the ambient transaction
          Transaction.Current = oldAmbient;  
     }  
}  
void OnCommitted(IAsyncResult asyncResult)  
{  
     CommittableTransaction committableTransaction;  
     committableTransaction = asyncResult as CommittableTransaction;
     Debug.Assert(committableTransaction != null);  
     try  
     {  
          using(committableTransaction)  
          {  
               committableTransaction.EndCommit(asyncResult);  
          }  
     }  
     catch(TransactionException e)  
     {  
          //Handle the failure to commit  
     }  
}  
```  
  
## <a name="see-also"></a><span data-ttu-id="aa96e-145">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="aa96e-145">See also</span></span>

- [<span data-ttu-id="aa96e-146">Implementieren einer impliziten Transaktion mit Transaktionsbereich</span><span class="sxs-lookup"><span data-stu-id="aa96e-146">Implementing an Implicit Transaction using Transaction Scope</span></span>](implementing-an-implicit-transaction-using-transaction-scope.md)
- [<span data-ttu-id="aa96e-147">Verarbeiten von Transaktionen</span><span class="sxs-lookup"><span data-stu-id="aa96e-147">Transaction Processing</span></span>](index.md)
