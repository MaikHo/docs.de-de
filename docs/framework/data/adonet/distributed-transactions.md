---
title: Verteilte Transaktionen
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: b6553d50039ca0f4888f0610b187c6b419a462b5
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/24/2020
ms.locfileid: "91153196"
---
# <a name="distributed-transactions"></a><span data-ttu-id="9d3de-102">Verteilte Transaktionen</span><span class="sxs-lookup"><span data-stu-id="9d3de-102">Distributed Transactions</span></span>

<span data-ttu-id="9d3de-103">Bei einer Transaktion handelt es sich u. a. um mehrere zusammenhängende Aufgaben, die entweder in ihrer Gesamtheit erfolgreich abgeschlossen werden (Commit) oder nicht (Abort).</span><span class="sxs-lookup"><span data-stu-id="9d3de-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="9d3de-104">Eine *verteilte Transaktion* ist eine Transaktion, die sich auf verschiedene Ressourcen auswirkt.</span><span class="sxs-lookup"><span data-stu-id="9d3de-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="9d3de-105">Damit ein Commit einer verteilten Transaktion erfolgreich ausgeführt werden kann, müssen alle Beteiligten gewährleisten, dass jede vorgenommene Datenänderung dauerhaft ist.</span><span class="sxs-lookup"><span data-stu-id="9d3de-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="9d3de-106">Änderungen müssen auch im Fall von Systemausfällen oder anderen unvorhergesehenen Ereignissen dauerhaft sein.</span><span class="sxs-lookup"><span data-stu-id="9d3de-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="9d3de-107">Sobald auch nur ein Beteiligter dies nicht gewährleisten kann, kann die gesamte Transaktion nicht ausgeführt werden, und sämtliche im Zuge der Transaktion durchgeführten Datenänderungen werden in einem Rollback zurückgenommen.</span><span class="sxs-lookup"><span data-stu-id="9d3de-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="9d3de-108">Wenn Sie versuchen, einen Commit oder Rollback für eine Transaktion auszuführen, wenn ein `DataReader` gestartet wird und die Transaktion aktiv ist, wird eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="9d3de-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="9d3de-109">Arbeiten mit System.Transactions</span><span class="sxs-lookup"><span data-stu-id="9d3de-109">Working with System.Transactions</span></span>  

 <span data-ttu-id="9d3de-110">In .NET Framework werden verteilte Transaktionen durch die API im <xref:System.Transactions>-Namespace verwaltet.</span><span class="sxs-lookup"><span data-stu-id="9d3de-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="9d3de-111">Die <xref:System.Transactions>-API delegiert die Behandlung verteilter Transaktionen an einen Transaktionsmonitor wie den MS DTC (Microsoft Distributed Transaction Coordinator), wenn mehrere ständige Ressourcen-Manager beteiligt sind.</span><span class="sxs-lookup"><span data-stu-id="9d3de-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="9d3de-112">Weitere Informationen finden Sie unter [Grundlagen der Transaktion](../transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="9d3de-112">For more information, see [Transaction Fundamentals](../transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="9d3de-113">Die Unterstützung der Auflistung in einer verteilten Transaktion mithilfe der `EnlistTransaction`-Methode, die eine Verbindung in einer <xref:System.Transactions.Transaction>-Instanz auflistet, ist eine neue Funktion in ADO.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="9d3de-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="9d3de-114">In früheren Versionen von ADO.NET wurde die explizite Eintragung in verteilte Transaktionen mithilfe der `EnlistDistributedTransaction`-Methode einer Verbindung für das Eintragen einer Verbindung in eine <xref:System.EnterpriseServices.ITransaction>-Instanz durchgeführt, die aus Gründen der Abwärtskompatibilität unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="9d3de-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="9d3de-115">Weitere Informationen zu Enterprise Services-Transaktionen finden Sie unter [Interoperabilität mit Enterprise Services und com+-Transaktionen](../transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="9d3de-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="9d3de-116">Wenn eine <xref:System.Transactions>-Transaktion mit dem .NET Framework-Anbieter für SQL Server unter Verwendung einer SQL Server-Datenbank verwendet wird, wird automatisch eine kompakte <xref:System.Transactions.Transaction> verwendet.</span><span class="sxs-lookup"><span data-stu-id="9d3de-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="9d3de-117">Die Transaktion kann anschließend bei Bedarf zu einer vollständig verteilten Transaktion heraufgestuft werden.</span><span class="sxs-lookup"><span data-stu-id="9d3de-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="9d3de-118">Weitere Informationen finden Sie unter [System. Transactions-Integration mit SQL Server](system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="9d3de-118">For more information, see [System.Transactions Integration with SQL Server](system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="9d3de-119">Die maximale Anzahl an verteilten Transaktionen, an denen eine Oracle-Datenbank gleichzeitig teilnehmen kann, liegt standardmäßig bei 10.</span><span class="sxs-lookup"><span data-stu-id="9d3de-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="9d3de-120">Nach der zehnten Transaktion wird, bei Verbindung mit einer Oracle-Datenbank, eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="9d3de-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="9d3de-121">Oracle bietet keine Unterstützung für `DDL` innerhalb einer verteilten Transaktion.</span><span class="sxs-lookup"><span data-stu-id="9d3de-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="9d3de-122">Automatisches Eintragen in eine verteilte Transaktion</span><span class="sxs-lookup"><span data-stu-id="9d3de-122">Automatically Enlisting in a Distributed Transaction</span></span>  

 <span data-ttu-id="9d3de-123">Die automatische Eintragung ist die Standard- (und bevorzugte) Methode zum Integrieren von ADO.NET-Verbindungen in die `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="9d3de-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="9d3de-124">Ein Verbindungsobjekt trägt sich automatisch in eine vorhandene verteilte Transaktion ein, wenn es feststellt, dass eine Transaktion aktiv ist. Bei `System.Transaction` bedeutet dies, dass `Transaction.Current` nicht NULL ist.</span><span class="sxs-lookup"><span data-stu-id="9d3de-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="9d3de-125">Die automatische Transaktionseintragung erfolgt beim Öffnen der Verbindung.</span><span class="sxs-lookup"><span data-stu-id="9d3de-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="9d3de-126">Dies erfolgt nicht anschließend, auch wenn ein Befehl innerhalb des Gültigkeitsbereichs einer Transaktion ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="9d3de-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="9d3de-127">Die automatische Eintragung in vorhandene Transaktionen kann durch die Angabe von `Enlist=false` als Parameter der Verbindungszeichenfolge für eine <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType> oder von `OLE DB Services=-7` als Parameter der Verbindungszeichenfolge für eine <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType> deaktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="9d3de-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="9d3de-128">Weitere Informationen zu Oracle- und ODBC-Parametern der Verbindungszeichenfolge finden Sie unter der <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> oder der <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9d3de-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="9d3de-129">Manuelles Eintragen in eine verteilte Transaktion</span><span class="sxs-lookup"><span data-stu-id="9d3de-129">Manually Enlisting in a Distributed Transaction</span></span>  

 <span data-ttu-id="9d3de-130">Wenn die automatische Eintragung deaktiviert ist oder wenn Sie eine Transaktion eintragen müssen, die nach dem Herstellen der Verbindung begonnen wurde, können Sie eine vorhandene verteilte Transaktion mithilfe der `EnlistTransaction`-Methode des <xref:System.Data.Common.DbConnection>-Objekts für den entsprechenden Anbieter eintragen.</span><span class="sxs-lookup"><span data-stu-id="9d3de-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="9d3de-131">Durch das Eintragen in eine vorhandene verteilte Transaktion wird sichergestellt, dass bei einem Commit oder Rollback der Transaktion auch die Änderungen einbezogen werden, die vom Code an der Datenquelle vorgenommen wurden.</span><span class="sxs-lookup"><span data-stu-id="9d3de-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="9d3de-132">Das Eintragen in verteilte Transaktionen eignet sich besonders beim Pooling von Geschäftsobjekten.</span><span class="sxs-lookup"><span data-stu-id="9d3de-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="9d3de-133">Wenn sich ein Geschäftsobjekt mit einer hergestellten Verbindung in einem Pool befindet, erfolgt die automatische Transaktionseintragung nur, wenn diese Verbindung hergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="9d3de-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="9d3de-134">Wenn mehrere Transaktionen unter Verwendung des Geschäftsobjekts im Pool ausgeführt werden, wird die für das Objekt hergestellte Verbindung nicht automatisch in neu initialisierte Transaktionen eingetragen.</span><span class="sxs-lookup"><span data-stu-id="9d3de-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="9d3de-135">In diesem Fall können Sie die automatische Transaktionseintragung für die Verbindung deaktivieren und die Verbindung mithilfe der `EnlistTransaction`-Methode in Transaktionen eintragen.</span><span class="sxs-lookup"><span data-stu-id="9d3de-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="9d3de-136">`EnlistTransaction` nimmt ein einzelnes Argument vom Typ <xref:System.Transactions.Transaction> an, das ein Verweis auf die vorhandene Transaktion ist.</span><span class="sxs-lookup"><span data-stu-id="9d3de-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="9d3de-137">Nach dem Aufrufen der `EnlistTransaction`-Methode der Verbindung werden alle Änderungen, die mit der Verbindung an der Datenquelle vorgenommen wurden, in die Transaktion eingetragen.</span><span class="sxs-lookup"><span data-stu-id="9d3de-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="9d3de-138">Beim Übergeben eines NULL-Werts wird die Verbindung aus der aktuellen verteilten Transaktionseintragung ausgetragen.</span><span class="sxs-lookup"><span data-stu-id="9d3de-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="9d3de-139">Beachten Sie, dass die Verbindung vor dem Aufrufen der `EnlistTransaction`-Methode hergestellt werden muss.</span><span class="sxs-lookup"><span data-stu-id="9d3de-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="9d3de-140">Nachdem eine Verbindung ausdrücklich in eine Transaktion eingetragen wurde, kann sie solange nicht ausgetragen oder in eine andere Transaktion eingetragen werden, bis die erste Transaktion beendet wurde.</span><span class="sxs-lookup"><span data-stu-id="9d3de-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="9d3de-141">Die `EnlistTransaction`-Methode löst eine Ausnahme aus, wenn die Verbindung bereits mithilfe ihrer <xref:System.Data.Common.DbConnection.BeginTransaction%2A>-Methode eine Transaktion begonnen hat.</span><span class="sxs-lookup"><span data-stu-id="9d3de-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="9d3de-142">Wenn es sich bei der Transaktion jedoch um eine lokale Transaktion handelt, die an der Datenquelle begonnen wurde (z. B. die explizite Ausführung der BEGIN TRANSACTION-ANWEISUNG mithilfe eines <xref:System.Data.SqlClient.SqlCommand>), führt die `EnlistTransaction`-Methode einen Rollback der lokalen Transaktion durch und trägt sich selbst wie angefordert in die vorhandene verteilte Transaktion ein.</span><span class="sxs-lookup"><span data-stu-id="9d3de-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="9d3de-143">Sie werden nicht über den Rollback der lokalen Transaktion benachrichtigt und müssen nicht begonnene lokale Transaktionen mithilfe der <xref:System.Data.Common.DbConnection.BeginTransaction%2A>-Methode verwalten.</span><span class="sxs-lookup"><span data-stu-id="9d3de-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="9d3de-144">Wenn Sie den .NET Framework-Datenanbieter für SQL Server (`SqlClient`) mit SQL Server verwenden, wird beim Eintragen eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="9d3de-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="9d3de-145">Alle anderen Fälle bleiben unerkannt.</span><span class="sxs-lookup"><span data-stu-id="9d3de-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="9d3de-146">Heraufstufbare Transaktionen in SQL Server</span><span class="sxs-lookup"><span data-stu-id="9d3de-146">Promotable Transactions in SQL Server</span></span>  

 <span data-ttu-id="9d3de-147">SQL Server unterstützt heraufstufbare Transaktionen, bei denen eine lokale kompakte Transaktion nur bei Bedarf automatisch zu einer verteilten Transaktion heraufgestuft werden kann.</span><span class="sxs-lookup"><span data-stu-id="9d3de-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="9d3de-148">Eine heraufstufbare Transaktion ruft den zusätzlichen Aufwand einer verteilten Transaktion nur hervor, wenn dieser erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="9d3de-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="9d3de-149">Weitere Informationen und ein Codebeispiel finden Sie unter [System. Transactions-Integration mit SQL Server](system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="9d3de-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="9d3de-150">Konfigurieren von verteilten Transaktionen</span><span class="sxs-lookup"><span data-stu-id="9d3de-150">Configuring Distributed Transactions</span></span>  

 <span data-ttu-id="9d3de-151">Möglicherweise müssen Sie MS DTC über das Netzwerk aktivieren, um verteilte Transaktionen zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="9d3de-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="9d3de-152">Wenn die Windows-Firewall aktiviert ist, müssen Sie dem MS DTC-Dienst die Erlaubnis erteilen, das Netzwerk zu verwenden, oder den MS DTC-Port öffnen.</span><span class="sxs-lookup"><span data-stu-id="9d3de-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9d3de-153">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="9d3de-153">See also</span></span>

- [<span data-ttu-id="9d3de-154">Transaktionen und Parallelität</span><span class="sxs-lookup"><span data-stu-id="9d3de-154">Transactions and Concurrency</span></span>](transactions-and-concurrency.md)
- [<span data-ttu-id="9d3de-155">System.Transactions-Integration in SQL Server</span><span class="sxs-lookup"><span data-stu-id="9d3de-155">System.Transactions Integration with SQL Server</span></span>](system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="9d3de-156">Übersicht über ADO.NET</span><span class="sxs-lookup"><span data-stu-id="9d3de-156">ADO.NET Overview</span></span>](ado-net-overview.md)
