---
title: N-Schicht-LINQ to SQL mit Webdiensten
ms.date: 03/30/2017
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
ms.openlocfilehash: 2a6e7cb177d475802d4516d6a7a91f9f5687eada
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/15/2020
ms.locfileid: "90555873"
---
# <a name="linq-to-sql-n-tier-with-web-services"></a><span data-ttu-id="2c676-102">N-Schicht-LINQ to SQL mit Webdiensten</span><span class="sxs-lookup"><span data-stu-id="2c676-102">LINQ to SQL N-Tier with Web Services</span></span>
[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="2c676-103">wurde speziell für die Verwendung auf der mittleren Ebene in einer lose gekoppelten Datenzugriffs Schicht (DAL), z. b. einem Webdienst, entwickelt.</span><span class="sxs-lookup"><span data-stu-id="2c676-103">is designed especially for use on the middle tier in a loosely-coupled data access layer (DAL) such as a Web service.</span></span> <span data-ttu-id="2c676-104">Wenn es sich bei der Präsentationsebene um eine ASP.NET-Webseite handelt, können Sie die Datenübertragung zwischen der Benutzeroberfläche und <xref:System.Web.UI.WebControls.LinqDataSource> auf der mittleren Ebene mithilfe des [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]-Webserversteuerelements verwalten.</span><span class="sxs-lookup"><span data-stu-id="2c676-104">If the presentation tier is an ASP.NET Web page, then you use the <xref:System.Web.UI.WebControls.LinqDataSource> Web server control to manage the data transfer between the user interface and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] on the middle-tier.</span></span> <span data-ttu-id="2c676-105">Wenn es sich bei der Präsentationsebene nicht um eine ASP.NET-Seite handelt, müssen sowohl die mittlere Ebene als auch die Präsentationsebene zusätzliche Arbeit leisten, um die Serialisierung und Deserialisierung von Daten zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="2c676-105">If the presentation tier is not an ASP.NET page, then both the middle-tier and the presentation tier must do some additional work to manage the serialization and deserialization of data.</span></span>  
  
## <a name="setting-up-linq-to-sql-on-the-middle-tier"></a><span data-ttu-id="2c676-106">Einrichten von LINQ to SQL auf der mittleren Ebene</span><span class="sxs-lookup"><span data-stu-id="2c676-106">Setting up LINQ to SQL on the Middle Tier</span></span>  
 <span data-ttu-id="2c676-107">In einem Webdienst oder einer N-Tier-Anwendung enthält die mittlere Ebene den Datenkontext und die Entitätsklassen.</span><span class="sxs-lookup"><span data-stu-id="2c676-107">In a Web service or n-tier application, the middle tier contains the data context and the entity classes.</span></span> <span data-ttu-id="2c676-108">Sie können diese Klassen manuell erstellen oder entweder mithilfe von SQLMetal.exe oder der objektrelationaler Designer, wie an anderer Stelle in der-Dokumentation beschrieben.</span><span class="sxs-lookup"><span data-stu-id="2c676-108">You can create these classes manually, or by using either SQLMetal.exe or the Object Relational Designer as described elsewhere in the documentation.</span></span> <span data-ttu-id="2c676-109">Zur Entwurfszeit können Sie die Entitätsklassen serialisierbar machen.</span><span class="sxs-lookup"><span data-stu-id="2c676-109">At design time, you have the option to make the entity classes serializable.</span></span> <span data-ttu-id="2c676-110">Weitere Informationen finden Sie unter Gewusst [wie: Erstellen von serialisierbaren Entitäten](how-to-make-entities-serializable.md).</span><span class="sxs-lookup"><span data-stu-id="2c676-110">For more information, see [How to: Make Entities Serializable](how-to-make-entities-serializable.md).</span></span> <span data-ttu-id="2c676-111">Eine andere Möglichkeit besteht darin, einen separaten Satz von Klassen zu erstellen, die die zu serialisierenden Daten Kapseln, und dann in diese serialisierbaren Typen zu projizieren, wenn Sie Daten in den LINQ-Abfragen zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="2c676-111">Another option is to create a separate set of classes that encapsulate the data to be serialized, and then project into those serializable types when you return data in your LINQ queries.</span></span>  
  
 <span data-ttu-id="2c676-112">Anschließend definieren Sie die Schnittstelle mithilfe der Methoden, die von Clients zum Abrufen, Einfügen und Aktualisieren von Daten aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="2c676-112">You then define the interface with the methods that the clients will call to retrieve, insert and update data.</span></span> <span data-ttu-id="2c676-113">Die Schnittstellen Methoden wrappen Ihre LINQ-Abfragen.</span><span class="sxs-lookup"><span data-stu-id="2c676-113">The interface methods wrap your LINQ queries.</span></span> <span data-ttu-id="2c676-114">Sie können einen beliebigen Serialisierungsmechanismus verwenden, um Remotemethodenaufrufe und die Serialisierung von Daten zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="2c676-114">You can use any kind of serialization mechanism to handle the remote method calls and the serialization of data.</span></span> <span data-ttu-id="2c676-115">Wenn Sie in Ihrem Objektmodell über zyklische oder bidirektionale Beziehungen verfügen, z. B. Beziehungen zwischen Customers und Orders im standardmäßigen Northwind-Objektmodell, besteht die einzige Voraussetzung darin, einen Serialisierer zu verwenden, der das Modell unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2c676-115">The only requirement is that if you have cyclic or bi-directional relationships in your object model, such as that between Customers and Orders in the standard Northwind object model, then you must use a serializer that supports it.</span></span> <span data-ttu-id="2c676-116">Die Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> unterstützt im Unterschied zum XmlSerializer, der mit Nicht-WCF-Webdiensten verwendet wird, bidirektionale Beziehungen.</span><span class="sxs-lookup"><span data-stu-id="2c676-116">The Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> supports bi-directional relationships but the XmlSerializer that is used with non-WCF Web services does not.</span></span> <span data-ttu-id="2c676-117">Wenn Sie den XmlSerializer verwenden möchten, müssen Sie sicherstellen, dass das Objektmodell keine zyklischen Beziehungen aufweist.</span><span class="sxs-lookup"><span data-stu-id="2c676-117">If you select to use the XmlSerializer, then you must make sure that your object model has no cyclic relationships.</span></span>  
  
 <span data-ttu-id="2c676-118">Weitere Informationen zu Windows Communication Foundation finden Sie unter [Windows Communication Foundation Services und WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="2c676-118">For more information about Windows Communication Foundation, see [Windows Communication Foundation Services and WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span></span>  
  
 <span data-ttu-id="2c676-119">Implementieren Sie Geschäftsregeln oder eine andere domänenspezifische Logik, indem Sie die partiellen Klassen und Methoden für<xref:System.Data.Linq.DataContext> und die Entitätsklassen verwenden, um [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]-Laufzeitereignisse zu verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="2c676-119">Implement your business rules or other domain-specific logic by using the partial classes and methods on the <xref:System.Data.Linq.DataContext> and entity classes to hook into [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] runtime events.</span></span> <span data-ttu-id="2c676-120">Weitere Informationen finden Sie unter [Implementieren von N-Tier-Geschäftslogik](implementing-business-logic-linq-to-sql.md).</span><span class="sxs-lookup"><span data-stu-id="2c676-120">For more information, see [Implementing N-Tier Business Logic](implementing-business-logic-linq-to-sql.md).</span></span>  
  
## <a name="defining-the-serializable-types"></a><span data-ttu-id="2c676-121">Definieren serialisierbarer Typen</span><span class="sxs-lookup"><span data-stu-id="2c676-121">Defining the Serializable Types</span></span>  
 <span data-ttu-id="2c676-122">Die Client- oder Präsentationsebene muss über Typdefinitionen für die Klassen verfügen, die Daten von der mittleren Ebene empfangen.</span><span class="sxs-lookup"><span data-stu-id="2c676-122">The client or presentation tier must have type definitions for the classes that it will be receiving from the middle tier.</span></span> <span data-ttu-id="2c676-123">Bei diesen Typen kann es sich um die Entitätsklassen selbst oder um spezielle Klassen handeln, die nur bestimmte Felder aus den Entitätsklassen für das Remoting umschließen.</span><span class="sxs-lookup"><span data-stu-id="2c676-123">Those types may be the entity classes themselves, or special classes that wrap only certain fields from the entity classes for remoting.</span></span> <span data-ttu-id="2c676-124">In jedem Fall [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] ist nicht davon betroffen, wie die Präsentationsebene diese Typdefinitionen abruft.</span><span class="sxs-lookup"><span data-stu-id="2c676-124">In any case, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] is completely unconcerned about how the presentation tier acquires those type definitions.</span></span> <span data-ttu-id="2c676-125">Die Präsentationsebene könnte beispielsweise WCF verwenden, um diese Typen automatisch zu generieren, oder sie könnte eine Kopie der DLL nutzen, in der diese Typen definiert sind. Alternativ könnte sie einfach eigene Versionen dieser Typen definieren.</span><span class="sxs-lookup"><span data-stu-id="2c676-125">For example, the presentation tier could use WCF to generate the types automatically, or it could have a copy of a DLL in which those types are defined, or it could just define its own versions of the types.</span></span>  
  
## <a name="retrieving-and-inserting-data"></a><span data-ttu-id="2c676-126">Abrufen und Einfügen von Daten</span><span class="sxs-lookup"><span data-stu-id="2c676-126">Retrieving and Inserting Data</span></span>  
 <span data-ttu-id="2c676-127">Die mittlere Ebene definiert eine Schnittstelle, durch die angegeben wird, wie die Präsentationsebene auf die Daten zugreift.</span><span class="sxs-lookup"><span data-stu-id="2c676-127">The middle tier defines an interface that specifies how the presentation tier accesses the data.</span></span> <span data-ttu-id="2c676-128">Beispiel: `GetProductByID(int productID)` oder `GetCustomers()`.</span><span class="sxs-lookup"><span data-stu-id="2c676-128">For example `GetProductByID(int productID)`, or `GetCustomers()`.</span></span> <span data-ttu-id="2c676-129">Auf der mittleren Ebene wird vom Methodentext normalerweise eine neue Instanz von <xref:System.Data.Linq.DataContext> erstellt und eine Abfrage gegen mindestens eine ihrer Tabellen ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="2c676-129">On the middle tier, the method body typically creates a new instance of the <xref:System.Data.Linq.DataContext>, executes a query against one or more of its table.</span></span> <span data-ttu-id="2c676-130">Die mittlere Ebene gibt dann das Ergebnis als <xref:System.Collections.Generic.IEnumerable%601> zurück, wobei `T` entweder eine Entitätsklasse oder ein anderer für die Serialisierung verwendeter Typ ist.</span><span class="sxs-lookup"><span data-stu-id="2c676-130">The middle tier then returns the result as an <xref:System.Collections.Generic.IEnumerable%601>, where `T` is either an entity class or another type that is used for serialization.</span></span> <span data-ttu-id="2c676-131">Über die Präsentationsebene werden Abfragevariablen nie direkt an die mittlere Ebene gesendet bzw. von ihr empfangen.</span><span class="sxs-lookup"><span data-stu-id="2c676-131">The presentation tier never sends or receives query variables directly to or from the middle tier.</span></span> <span data-ttu-id="2c676-132">Die beiden Ebenen tauschen Werte, Objekte und Auflistungen konkreter Daten aus.</span><span class="sxs-lookup"><span data-stu-id="2c676-132">The two tiers exchange values, objects, and collections of concrete data.</span></span> <span data-ttu-id="2c676-133">Nachdem eine Sammlung empfangen wurde, kann die Präsentationsebene LINQ to Objects verwenden, um Sie bei Bedarf abzufragen.</span><span class="sxs-lookup"><span data-stu-id="2c676-133">After it has received a collection, the presentation tier can use LINQ to Objects to query it if necessary.</span></span>  
  
 <span data-ttu-id="2c676-134">Bein Einfügen von Daten kann die Präsentationsebene ein neues Objekt erstellen und es an die mittlere Ebene senden, oder sie kann das Objekt von der mittleren Ebene auf der Grundlage der von ihr gelieferten Daten erstellen lassen.</span><span class="sxs-lookup"><span data-stu-id="2c676-134">When inserting data, the presentation tier can construct a new object and send it to the middle tier, or it can have the middle tier construct the object based on values that it provides.</span></span> <span data-ttu-id="2c676-135">Im Allgemeinen unterscheidet sich das Abrufen und Einfügen von Daten in N-Tier-Anwendungen nicht von der Vorgehensweise in 2-Tier-Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="2c676-135">In general, retrieving and inserting data in n-tier applications does not differ much from the process in 2-tier applications.</span></span> <span data-ttu-id="2c676-136">Weitere Informationen finden Sie unter [Abfragen der Datenbank](querying-the-database.md) und erstellen und Übermitteln von [Datenänderungen](making-and-submitting-data-changes.md).</span><span class="sxs-lookup"><span data-stu-id="2c676-136">For more information, see [Querying the Database](querying-the-database.md) and [Making and Submitting Data Changes](making-and-submitting-data-changes.md).</span></span>  
  
## <a name="tracking-changes-for-updates-and-deletes"></a><span data-ttu-id="2c676-137">Nachverfolgen von Änderungen für Update- und Löschvorgänge</span><span class="sxs-lookup"><span data-stu-id="2c676-137">Tracking Changes for Updates and Deletes</span></span>  
 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="2c676-138">unterstützt vollständige Parallelität auf der Basis von Timestamps (auch als RowVersions bezeichnet) und ursprünglichen Werten.</span><span class="sxs-lookup"><span data-stu-id="2c676-138">supports optimistic concurrency based on timestamps (also named RowVersions) and on original values.</span></span> <span data-ttu-id="2c676-139">Wenn die Datenbanktabellen über Timestamps verfügen, ist auf der mittleren oder Präsentationsebene wenig zusätzliche Arbeit für Update- und Löschvorgänge erforderlich.</span><span class="sxs-lookup"><span data-stu-id="2c676-139">If the database tables have timestamps, then updates and deletions require little extra work on either the middle-tier or presentation tier.</span></span> <span data-ttu-id="2c676-140">Wenn Sie für Überprüfungen auf vollständige Parallelität jedoch Originalwerte verwenden müssen, ist die Präsentationsebene dafür verantwortlich, diese Werte zu verfolgen und sie bei der Ausführung von Updates zurückzusenden.</span><span class="sxs-lookup"><span data-stu-id="2c676-140">However, if you must use original values for optimistic concurrency checks, then the presentation tier is responsible for tracking those values and sending them back when it makes updates.</span></span> <span data-ttu-id="2c676-141">Dies liegt daran, dass Änderungen, die an Entitäten auf der Präsentationsebene vorgenommen wurden, nicht auf der mittleren Ebene verfolgt werden.</span><span class="sxs-lookup"><span data-stu-id="2c676-141">This is because changes that were made to entities on the presentation tier are not tracked on the middle tier.</span></span> <span data-ttu-id="2c676-142">Tatsächlich werden das ursprüngliche Abrufen einer Entität und das endgültig vorgenommene Update normalerweise von zwei vollständig getrennten <xref:System.Data.Linq.DataContext>-Instanzen ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="2c676-142">In fact, the original retrieval of an entity, and the eventual update made to it are typically performed by two completely separate instances of the <xref:System.Data.Linq.DataContext>.</span></span>  
  
 <span data-ttu-id="2c676-143">Je größer die Anzahl der Änderungen ist, die von der Präsentationsebene vorgenommen werden, desto komplexer ist das Verfolgen dieser Änderungen und das Zurückpacken auf die mittlere Ebene.</span><span class="sxs-lookup"><span data-stu-id="2c676-143">The greater the number of changes that the presentation tier makes, the more complex it becomes to track those changes and package them back to the middle tier.</span></span> <span data-ttu-id="2c676-144">Die Implementierung eines Mechanismus zum Kommunizieren von Änderungen liegt vollständig in der Zuständigkeit der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="2c676-144">The implementation of a mechanism for communicating changes is completely up to the application.</span></span> <span data-ttu-id="2c676-145">Die einzige Anforderung besteht darin, dass die ursprünglichen Werte, die für Überprüfungen auf vollständige Parallelität erforderlich sind, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] zur Verfügung gestellt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="2c676-145">The only requirement is that [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] must be given those original values that are required for optimistic concurrency checks.</span></span>  
  
 <span data-ttu-id="2c676-146">Weitere Informationen finden Sie unter [Datenabruf-und CUD-Vorgänge in N-Tier-Anwendungen (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span><span class="sxs-lookup"><span data-stu-id="2c676-146">For more information, see [Data Retrieval and CUD Operations in N-Tier Applications (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2c676-147">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="2c676-147">See also</span></span>

- [<span data-ttu-id="2c676-148">N-Tier-und Remote Anwendungen mit LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="2c676-148">N-Tier and Remote Applications with LINQ to SQL</span></span>](n-tier-and-remote-applications-with-linq-to-sql.md)
- <span data-ttu-id="2c676-149">[Übersicht über das LinqDataSource-Webserver Steuerelement](/previous-versions/aspnet/bb547113(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="2c676-149">[LinqDataSource Web Server Control Overview](/previous-versions/aspnet/bb547113(v=vs.100))</span></span>
