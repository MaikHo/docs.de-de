---
title: "\"SqlDependency\" in einer ASP.NET-Anwendung"
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: ff226ce3-f6b5-47a1-8d22-dc78b67e07f5
ms.openlocfilehash: 2ec9415f63151443d5008fbce471fabeb89cdb91
ms.sourcegitcommit: 1e8382d0ce8b5515864f8fbb178b9fd692a7503f
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/10/2020
ms.locfileid: "89656170"
---
# <a name="sqldependency-in-an-aspnet-application"></a><span data-ttu-id="d8063-102">"SqlDependency" in einer ASP.NET-Anwendung</span><span class="sxs-lookup"><span data-stu-id="d8063-102">SqlDependency in an ASP.NET Application</span></span>
<span data-ttu-id="d8063-103">Das Beispiel in diesem Abschnitt zeigt, wie <xref:System.Data.SqlClient.SqlDependency> durch die Nutzung des ASP.NET <xref:System.Web.Caching.SqlCacheDependency>-Objekts indirekt verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="d8063-103">The example in this section shows how to use <xref:System.Data.SqlClient.SqlDependency> indirectly by leveraging the ASP.NET <xref:System.Web.Caching.SqlCacheDependency> object.</span></span> <span data-ttu-id="d8063-104">Das <xref:System.Web.Caching.SqlCacheDependency>-Objekt verwendet ein <xref:System.Data.SqlClient.SqlDependency>, um auf Benachrichtigungen zu lauschen und den Cache ordnungsgemäß zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="d8063-104">The <xref:System.Web.Caching.SqlCacheDependency> object uses a <xref:System.Data.SqlClient.SqlDependency> to listen for notifications and correctly update the cache.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d8063-105">Im Beispielcode wird davon ausgegangen, dass Sie Abfrage Benachrichtigungen aktiviert haben, indem Sie die Skripts unter [Aktivieren von Abfrage Benachrichtigungen](enabling-query-notifications.md)ausführen.</span><span class="sxs-lookup"><span data-stu-id="d8063-105">The sample code assumes that you have enabled query notifications by executing the scripts in [Enabling Query Notifications](enabling-query-notifications.md).</span></span>  
  
## <a name="about-the-sample-application"></a><span data-ttu-id="d8063-106">Die Beispielanwendung</span><span class="sxs-lookup"><span data-stu-id="d8063-106">About the Sample Application</span></span>  
 <span data-ttu-id="d8063-107">In der Beispielanwendung wird eine einzelne ASP.NET-Webseite verwendet, um Produktinformationen aus der SQL Server-**AdventureWorks**-Datenbank in einem <xref:System.Web.UI.WebControls.GridView>-Steuerelement anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="d8063-107">The sample application uses a single ASP.NET Web page to display product information from the **AdventureWorks** SQL Server database in a <xref:System.Web.UI.WebControls.GridView> control.</span></span> <span data-ttu-id="d8063-108">Wenn die Seite geladen wird, schreibt der Code die aktuelle Uhrzeit in ein <xref:System.Web.UI.WebControls.Label>-Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="d8063-108">When the page loads, the code writes the current time to a <xref:System.Web.UI.WebControls.Label> control.</span></span> <span data-ttu-id="d8063-109">Anschließend wird ein <xref:System.Web.Caching.SqlCacheDependency>-Objekt definiert, und es werden Eigenschaften für das <xref:System.Web.Caching.Cache>-Objekt festgelegt, um die Cachedaten bis zu drei Minuten zu speichern.</span><span class="sxs-lookup"><span data-stu-id="d8063-109">It then defines a <xref:System.Web.Caching.SqlCacheDependency> object and sets properties on the <xref:System.Web.Caching.Cache> object to store the cache data for up to three minutes.</span></span> <span data-ttu-id="d8063-110">Der Code stellt dann eine Verbindung mit der Datenbank her und ruft die Daten ab.</span><span class="sxs-lookup"><span data-stu-id="d8063-110">The code then connects to the database and retrieves the data.</span></span> <span data-ttu-id="d8063-111">Wenn die Seite geladen ist und die Anwendung ausgeführt wird, ruft ASP.NET Daten aus dem Cache ab, was Sie bestätigen können, indem Sie feststellen, dass sich die Zeit auf der Seite nicht ändert.</span><span class="sxs-lookup"><span data-stu-id="d8063-111">When the page is loaded and the application is running ASP.NET will retrieve data from the cache, which you can verify by noting that the time on the page does not change.</span></span> <span data-ttu-id="d8063-112">Wenn sich die überwachten Daten ändern, macht ASP.NET den Cache ungültig und füllt das `GridView`-Steuerelement erneut mit aktuellen Daten auf, wobei die im `Label`-Steuerelement angezeigte Uhrzeit aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="d8063-112">If the data being monitored changes, ASP.NET invalidates the cache and repopulate the `GridView` control with fresh data, updating the time displayed in the `Label` control.</span></span>  
  
## <a name="creating-the-sample-application"></a><span data-ttu-id="d8063-113">Erstellen der Beispielanwendung</span><span class="sxs-lookup"><span data-stu-id="d8063-113">Creating the Sample Application</span></span>  
 <span data-ttu-id="d8063-114">Befolgen Sie diese Anweisungen, um die Beispielanwendung zu erstellen und auszuführen:</span><span class="sxs-lookup"><span data-stu-id="d8063-114">Follow these steps to create and run the sample application:</span></span>  
  
1. <span data-ttu-id="d8063-115">Erstellen Sie eine neue ASP.NET-Website.</span><span class="sxs-lookup"><span data-stu-id="d8063-115">Create a new ASP.NET Web site.</span></span>  
  
2. <span data-ttu-id="d8063-116">Fügen Sie der Seite „Default.aspx“ die Steuerelemente <xref:System.Web.UI.WebControls.Label> und <xref:System.Web.UI.WebControls.GridView> hinzu.</span><span class="sxs-lookup"><span data-stu-id="d8063-116">Add a <xref:System.Web.UI.WebControls.Label> and a <xref:System.Web.UI.WebControls.GridView> control to the Default.aspx page.</span></span>  
  
3. <span data-ttu-id="d8063-117">Öffnen Sie das Klassenmodul der Seite, und fügen Sie die folgenden Anweisungen hinzu:</span><span class="sxs-lookup"><span data-stu-id="d8063-117">Open the page's class module and add the following directives:</span></span>  
  
    ```vb  
    Option Strict On  
    Option Explicit On  
  
    Imports System.Data.SqlClient  
    ```  
  
    ```csharp  
    using System.Data.SqlClient;  
    using System.Web.Caching;  
    ```  
  
4. <span data-ttu-id="d8063-118">Fügen Sie den folgenden Code in das Ereignis `Page_Load` der Seite ein:</span><span class="sxs-lookup"><span data-stu-id="d8063-118">Add the following code in the page's `Page_Load` event:</span></span>  
  
     [!code-csharp[DataWorks SqlDependency.AspNet#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#1)]
     [!code-vb[DataWorks SqlDependency.AspNet#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#1)]  
  
5. <span data-ttu-id="d8063-119">Fügen Sie die beiden Hilfsmethoden `GetConnectionString` und `GetSQL` hinzu.</span><span class="sxs-lookup"><span data-stu-id="d8063-119">Add two helper methods, `GetConnectionString` and `GetSQL`.</span></span> <span data-ttu-id="d8063-120">Die definierte Verbindungszeichenfolge verwendet die integrierte Sicherheit.</span><span class="sxs-lookup"><span data-stu-id="d8063-120">The connection string defined uses integrated security.</span></span> <span data-ttu-id="d8063-121">Sie müssen sicherstellen, dass das verwendete Konto über die erforderlichen Datenbankberechtigungen verfügt und dass für die Beispieldatenbank **AdventureWorks** Benachrichtigungen aktiviert sind.</span><span class="sxs-lookup"><span data-stu-id="d8063-121">You will need to verify that the account you are using has the necessary database permissions and that the sample database, **AdventureWorks**, has notifications enabled.</span></span>
  
     [!code-csharp[DataWorks SqlDependency.AspNet#2](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#2)]
     [!code-vb[DataWorks SqlDependency.AspNet#2](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#2)]  
  
### <a name="testing-the-application"></a><span data-ttu-id="d8063-122">Testen der Anwendung</span><span class="sxs-lookup"><span data-stu-id="d8063-122">Testing the Application</span></span>  
 <span data-ttu-id="d8063-123">Die Anwendung speichert die auf dem Webformular angezeigten Daten im Cache und aktualisiert sie alle drei Minuten, sofern keine Aktivität stattfindet.</span><span class="sxs-lookup"><span data-stu-id="d8063-123">The application caches the data displayed on the Web form and refreshes it every three minutes if there is no activity.</span></span> <span data-ttu-id="d8063-124">Wenn eine Änderung an der Datenbank vorgenommen wird, wird der Cache sofort aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="d8063-124">If a change occurs to the database, the cache is refreshed immediately.</span></span> <span data-ttu-id="d8063-125">Führen Sie die Anwendung in Visual Studio aus, wodurch die Seite in den Browser geladen wird.</span><span class="sxs-lookup"><span data-stu-id="d8063-125">Run the application from Visual Studio, which loads the page into the browser.</span></span> <span data-ttu-id="d8063-126">Die gezeigte Aktualisierungszeit des Caches gibt an, wann der Cache zuletzt aktualisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="d8063-126">The cache refresh time displayed indicates when the cache was last refreshed.</span></span> <span data-ttu-id="d8063-127">Warten Sie drei Minuten, und laden Sie dann die Seite neu, wodurch ein Postback-Ereignis ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="d8063-127">Wait three minutes, and then refresh the page, causing a postback event to occur.</span></span> <span data-ttu-id="d8063-128">Beachten Sie, dass sich die auf der Seite gezeigte Zeit geändert hat.</span><span class="sxs-lookup"><span data-stu-id="d8063-128">Note that the time displayed on the page has changed.</span></span> <span data-ttu-id="d8063-129">Wenn Sie die Seite in weniger als drei Minuten aktualisieren, bleibt die auf der Seite gezeigte Zeit gleich.</span><span class="sxs-lookup"><span data-stu-id="d8063-129">If you refresh the page in less than three minutes, the time displayed on the page will remain the same.</span></span>  
  
 <span data-ttu-id="d8063-130">Aktualisieren Sie nun mit dem Transact-SQL-Befehl UPDATE die Daten in der Datenbank und anschließend die Seite.</span><span class="sxs-lookup"><span data-stu-id="d8063-130">Now update the data in the database, using a Transact-SQL UPDATE command and refresh the page.</span></span> <span data-ttu-id="d8063-131">Die jetzt gezeigte Zeit bedeutet, dass der Cache mit den neuen Daten aus der Datenbank aktualisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="d8063-131">The time displayed now indicates that the cache was refreshed with the new data from the database.</span></span> <span data-ttu-id="d8063-132">Beachten Sie, dass, obwohl der Cache aktualisiert wurde, die auf der Seite gezeigte Zeit sich solange nicht ändert, bis ein Postback-Ereignis eintritt.</span><span class="sxs-lookup"><span data-stu-id="d8063-132">Note that although the cache is updated, the time displayed on the page does not change until a postback event occurs.</span></span>  

## <a name="distributed-cache-synchronization-using-sql-dependency"></a><span data-ttu-id="d8063-133">Synchronisierung verteilter Caches mithilfe von SQL-Abhängigkeit</span><span class="sxs-lookup"><span data-stu-id="d8063-133">Distributed cache synchronization using SQL Dependency</span></span>

<span data-ttu-id="d8063-134">Einige der verteilten Caches von Drittanbietern, z. b. [NCache](https://www.alachisoft.com/ncache) , bieten Unterstützung für die Synchronisierung von SQL-Datenbank und Cache mithilfe von [SQL-Abhängigkeiten](https://www.alachisoft.com/resources/docs/ncache/prog-guide/sql-dependency.html).</span><span class="sxs-lookup"><span data-stu-id="d8063-134">Some of the third-party distributed caches such as [NCache](https://www.alachisoft.com/ncache) provide support to synchronize the SQL database and cache using [SQL Dependency](https://www.alachisoft.com/resources/docs/ncache/prog-guide/sql-dependency.html).</span></span> <span data-ttu-id="d8063-135">Weitere Informationen und eine Beispiel-Quell Code Implementierung finden Sie unter [SQL-Abhängigkeits Beispiel für verteilte Caches](https://github.com/Alachisoft/NCache-Samples/tree/master/dotnet/Dependencies/SQLDependency).</span><span class="sxs-lookup"><span data-stu-id="d8063-135">For more information and an example source code implementation, see [Distributed cache SQL Dependency sample](https://github.com/Alachisoft/NCache-Samples/tree/master/dotnet/Dependencies/SQLDependency).</span></span>

## <a name="see-also"></a><span data-ttu-id="d8063-136">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="d8063-136">See also</span></span>

- [<span data-ttu-id="d8063-137">Abfrage Benachrichtigungen in SQL Server</span><span class="sxs-lookup"><span data-stu-id="d8063-137">Query Notifications in SQL Server</span></span>](query-notifications-in-sql-server.md)
- [<span data-ttu-id="d8063-138">Übersicht über ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d8063-138">ADO.NET Overview</span></span>](../ado-net-overview.md)
