---
title: Verteilte Daten
description: Vergleichen Sie die Datenspeicherung in monolithischen und cloudbasierten Anwendungen.
author: robvet
ms.date: 05/13/2020
ms.openlocfilehash: b7c8c43b16f2f70f9009c4fe4a8d19c52fa7ea2a
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/24/2020
ms.locfileid: "91163933"
---
# <a name="distributed-data"></a><span data-ttu-id="99d69-103">Verteilte Daten</span><span class="sxs-lookup"><span data-stu-id="99d69-103">Distributed data</span></span>

<span data-ttu-id="99d69-104">Wie wir bereits in diesem Buch gesehen haben, verändert ein cloudbasierter Ansatz die Art und Weise, wie Sie Anwendungen entwerfen, bereitstellen und verwalten.</span><span class="sxs-lookup"><span data-stu-id="99d69-104">As we've seen throughout this book, a cloud-native approach changes the way you design, deploy, and manage applications.</span></span> <span data-ttu-id="99d69-105">Außerdem wird die Art und Weise geändert, in der Sie Daten verwalten und speichern.</span><span class="sxs-lookup"><span data-stu-id="99d69-105">It also changes the way you manage and store data.</span></span>

<span data-ttu-id="99d69-106">In Abbildung 5-1 werden die Unterschiede dargestellt.</span><span class="sxs-lookup"><span data-stu-id="99d69-106">Figure 5-1 contrasts the differences.</span></span>

![Datenspeicherung in Cloud-native Anwendungen](./media/distributed-data.png)

<span data-ttu-id="99d69-108">**Abbildung 5–1**.</span><span class="sxs-lookup"><span data-stu-id="99d69-108">**Figure 5-1**.</span></span> <span data-ttu-id="99d69-109">Datenverwaltung in Cloud-native Anwendungen</span><span class="sxs-lookup"><span data-stu-id="99d69-109">Data management in cloud-native applications</span></span>

<span data-ttu-id="99d69-110">Erfahrene Entwickler können die Architektur auf der linken Seite der Abbildung 5-1 leicht erkennen.</span><span class="sxs-lookup"><span data-stu-id="99d69-110">Experienced developers will easily recognize the architecture on the left-side of figure 5-1.</span></span> <span data-ttu-id="99d69-111">In dieser *monolithischen Anwendung*werden die Geschäfts Dienst Komponenten gemeinsam in einer gemeinsamen Dienst Ebene zusammengefasst, wobei Daten aus einer einzelnen relationalen Datenbank gemeinsam genutzt werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-111">In this *monolithic application*, business service components collocate together in a shared services tier, sharing data from a single relational database.</span></span>

<span data-ttu-id="99d69-112">In vielerlei Hinsicht sorgt eine einzelne Datenbank für eine einfache Datenverwaltung.</span><span class="sxs-lookup"><span data-stu-id="99d69-112">In many ways, a single database keeps data management simple.</span></span> <span data-ttu-id="99d69-113">Das Abfragen von Daten über mehrere Tabellen hinweg ist einfach.</span><span class="sxs-lookup"><span data-stu-id="99d69-113">Querying data across multiple tables is straightforward.</span></span> <span data-ttu-id="99d69-114">Änderungen am Datenupdate oder alle Rollbacks.</span><span class="sxs-lookup"><span data-stu-id="99d69-114">Changes to data update together or they all rollback.</span></span> <span data-ttu-id="99d69-115">[ACID-Transaktionen](/windows/desktop/cossdk/acid-properties) garantieren hohe und unmittelbare Konsistenz.</span><span class="sxs-lookup"><span data-stu-id="99d69-115">[ACID transactions](/windows/desktop/cossdk/acid-properties) guarantee strong and immediate consistency.</span></span>

<span data-ttu-id="99d69-116">Der Entwurf für die cloudbasierte, wir Unternehmen einen anderen Ansatz.</span><span class="sxs-lookup"><span data-stu-id="99d69-116">Designing for cloud-native, we take a different approach.</span></span> <span data-ttu-id="99d69-117">Beachten Sie auf der rechten Seite der Abbildung 5-1, wie Geschäftsfunktionen in kleine, unabhängige microservices aufgeteilt werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-117">On the right-side of Figure 5-1, note how business functionality segregates into small, independent microservices.</span></span> <span data-ttu-id="99d69-118">Jeder microservice kapselt eine bestimmte Geschäftsfunktion und eigene Daten.</span><span class="sxs-lookup"><span data-stu-id="99d69-118">Each microservice encapsulates a specific business capability and its own data.</span></span> <span data-ttu-id="99d69-119">Die monolithische Datenbank zerlegt in ein verteiltes Datenmodell mit vielen kleineren Datenbanken, die jeweils mit einem-mikrodienst ausgerichtet sind.</span><span class="sxs-lookup"><span data-stu-id="99d69-119">The monolithic database decomposes into a distributed data model with many smaller databases, each aligning with a microservice.</span></span> <span data-ttu-id="99d69-120">Wenn der Rauch gelöscht wird, entsteht ein Entwurf, der eine *Datenbank pro Microsoft-Dienst*verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="99d69-120">When the smoke clears, we emerge with a design that exposes a *database per microservice*.</span></span>

## <a name="database-per-microservice-why"></a><span data-ttu-id="99d69-121">Database-per-mikroservice, warum?</span><span class="sxs-lookup"><span data-stu-id="99d69-121">Database-per-microservice, why?</span></span>

<span data-ttu-id="99d69-122">Diese Datenbank pro mikroservice bietet zahlreiche Vorteile, insbesondere für Systeme, die sich schnell weiterentwickeln und umfangreiche Skalierungen unterstützen müssen.</span><span class="sxs-lookup"><span data-stu-id="99d69-122">This database per microservice provides many benefits, especially for systems that must evolve rapidly and support massive scale.</span></span> <span data-ttu-id="99d69-123">Mit diesem Modell...</span><span class="sxs-lookup"><span data-stu-id="99d69-123">With this model...</span></span>

- <span data-ttu-id="99d69-124">Domänen Daten werden im Dienst gekapselt.</span><span class="sxs-lookup"><span data-stu-id="99d69-124">Domain data is encapsulated within the service</span></span>
- <span data-ttu-id="99d69-125">Das Datenschema kann sich weiterentwickeln, ohne dass andere Dienste direkt beeinträchtigt werden</span><span class="sxs-lookup"><span data-stu-id="99d69-125">Data schema can evolve without directly impacting other services</span></span>
- <span data-ttu-id="99d69-126">Jeder Datenspeicher kann unabhängig voneinander skaliert werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-126">Each data store can independently scale</span></span>
- <span data-ttu-id="99d69-127">Ein Datenspeicherfehler in einem Dienst wirkt sich nicht direkt auf andere Dienste aus.</span><span class="sxs-lookup"><span data-stu-id="99d69-127">A data store failure in one service won't directly impact other services</span></span>

<span data-ttu-id="99d69-128">Durch das Trennen von Daten können die einzelnen mikrodienste auch den Daten Speichertyp implementieren, der am besten für die Arbeitsauslastung, den Speicherbedarf und die Lese-/Schreibmuster optimiert ist.</span><span class="sxs-lookup"><span data-stu-id="99d69-128">Segregating data also enables each microservice to implement the data store type that is best optimized for its workload, storage needs, and read/write patterns.</span></span> <span data-ttu-id="99d69-129">Zu den Optionen gehören relationale, Dokument-, Schlüssel-Wert-und sogar Graph-basierte Datenspeicher.</span><span class="sxs-lookup"><span data-stu-id="99d69-129">Choices include relational, document, key-value, and even graph-based data stores.</span></span>

<span data-ttu-id="99d69-130">In Abbildung 5-2 wird das Prinzip der Polyglot-Persistenz in einem systemeigenen cloudsystem dargestellt.</span><span class="sxs-lookup"><span data-stu-id="99d69-130">Figure 5-2 presents the principle of polyglot persistence in a cloud-native system.</span></span>

![Polyglot-Daten Persistenz](./media/polyglot-data-persistence.png)

<span data-ttu-id="99d69-132">**Abbildung 5-2**.</span><span class="sxs-lookup"><span data-stu-id="99d69-132">**Figure 5-2**.</span></span> <span data-ttu-id="99d69-133">Polyglot-Daten Persistenz</span><span class="sxs-lookup"><span data-stu-id="99d69-133">Polyglot data persistence</span></span>

<span data-ttu-id="99d69-134">Beachten Sie in der vorherigen Abbildung, wie jeder-Dienst einen anderen Typ von Datenspeicher unterstützt.</span><span class="sxs-lookup"><span data-stu-id="99d69-134">Note in the previous figure how each microservice supports a different type of data store.</span></span>

- <span data-ttu-id="99d69-135">Der Product Catalog-Mikro Dienst nutzt eine relationale Datenbank, um die umfangreiche relationale Struktur der zugrunde liegenden Daten aufzunehmen.</span><span class="sxs-lookup"><span data-stu-id="99d69-135">The product catalog microservice consumes a relational database to accommodate the rich relational structure of its underlying data.</span></span>
- <span data-ttu-id="99d69-136">Der Einkaufswagen-mikrodienst beansprucht einen verteilten Cache, der seinen einfachen Schlüssel-Wert-Datenspeicher unterstützt.</span><span class="sxs-lookup"><span data-stu-id="99d69-136">The shopping cart microservice consumes a distributed cache that supports its simple, key-value data store.</span></span>
- <span data-ttu-id="99d69-137">Der Mikro Dienst Bestellung verwendet sowohl eine nosql-dokumentdatenbank für Schreibvorgänge als auch einen streng denormalisierten Schlüssel-Wert-Speicher, um große Mengen von Lesevorgängen aufzunehmen.</span><span class="sxs-lookup"><span data-stu-id="99d69-137">The ordering microservice consumes both a NoSql document database for write operations along with a highly denormalized key/value store to accommodate high-volumes of read operations.</span></span>
  
<span data-ttu-id="99d69-138">Obwohl relationale Datenbanken für die Verwendung komplexer Daten in Bezug auf mikrodienste relevant sind, haben nosql-Datenbanken eine beträchtliche Beliebtheit.</span><span class="sxs-lookup"><span data-stu-id="99d69-138">While relational databases remain relevant for microservices with complex data, NoSQL databases have gained considerable popularity.</span></span> <span data-ttu-id="99d69-139">Sie bieten enorme Skalierbarkeit und Hochverfügbarkeit.</span><span class="sxs-lookup"><span data-stu-id="99d69-139">They provide massive scale and high availability.</span></span> <span data-ttu-id="99d69-140">Die Schema lose Natur ermöglicht Entwicklern, von einer Architektur typisierter Daten Klassen und ORMs zu wechseln, die die kostenaufwendig und zeitaufwändig gestalten.</span><span class="sxs-lookup"><span data-stu-id="99d69-140">Their schemaless nature allows developers to move away from an architecture of typed data classes and ORMs that make change expensive and time-consuming.</span></span> <span data-ttu-id="99d69-141">Wir behandeln später in diesem Kapitel nosql-Datenbanken.</span><span class="sxs-lookup"><span data-stu-id="99d69-141">We cover NoSQL databases later in this chapter.</span></span>

 <span data-ttu-id="99d69-142">Obwohl das Kapseln von Daten in separate microservices die Flexibilität, Leistung und Skalierbarkeit erhöhen kann, stellt es auch viele Herausforderungen dar.</span><span class="sxs-lookup"><span data-stu-id="99d69-142">While encapsulating  data into separate microservices can increase agility, performance, and scalability, it also presents many challenges.</span></span> <span data-ttu-id="99d69-143">Im nächsten Abschnitt werden diese Herausforderungen zusammen mit Mustern und Verfahren erläutert, die Ihnen dabei helfen, Sie zu überwinden.</span><span class="sxs-lookup"><span data-stu-id="99d69-143">In the next section, we discuss these challenges along with patterns and practices to help overcome them.</span></span>  

## <a name="cross-service-queries"></a><span data-ttu-id="99d69-144">Dienst übergreifende Abfragen</span><span class="sxs-lookup"><span data-stu-id="99d69-144">Cross-service queries</span></span>

<span data-ttu-id="99d69-145">Obwohl die-Funktionen von-Diensten unabhängig sind und sich auf bestimmte funktionale Funktionen konzentrieren, wie z. b. Inventur, Versand oder Bestellung, benötigen Sie häufig eine Integration in andere-Dienste.</span><span class="sxs-lookup"><span data-stu-id="99d69-145">While microservices are independent and focus on specific functional capabilities, like inventory, shipping, or ordering, they frequently require integration with other microservices.</span></span> <span data-ttu-id="99d69-146">Häufig umfasst die Integration einen mikrodienst, der einen anderen für Daten *abfragt* .</span><span class="sxs-lookup"><span data-stu-id="99d69-146">Often the integration involves one microservice *querying* another for data.</span></span> <span data-ttu-id="99d69-147">In Abbildung 5-3 ist das Szenario dargestellt.</span><span class="sxs-lookup"><span data-stu-id="99d69-147">Figure 5-3 shows the scenario.</span></span>

![Übergreifende Abfragen von Abfragen](./media/cross-service-query.png)

<span data-ttu-id="99d69-149">**Abbildung 5-3**.</span><span class="sxs-lookup"><span data-stu-id="99d69-149">**Figure 5-3**.</span></span> <span data-ttu-id="99d69-150">Übergreifende Abfragen von Abfragen</span><span class="sxs-lookup"><span data-stu-id="99d69-150">Querying across microservices</span></span>

<span data-ttu-id="99d69-151">In der obigen Abbildung sehen wir einen Warenkorb-microservice, der dem Warenkorb eines Benutzers ein Element hinzufügt.</span><span class="sxs-lookup"><span data-stu-id="99d69-151">In the preceding figure, we see a shopping basket microservice that adds an item to a user's shopping basket.</span></span> <span data-ttu-id="99d69-152">Während der Datenspeicher für diesen microservice Korb-und Zeilen Elementdaten enthält, werden die Produkt-oder Preisdaten nicht beibehalten.</span><span class="sxs-lookup"><span data-stu-id="99d69-152">While the data store for this microservice contains basket and line item data, it doesn't maintain product or pricing data.</span></span> <span data-ttu-id="99d69-153">Stattdessen befinden sich diese Datenelemente im Besitz des Katalogs und der Preise für die Preise.</span><span class="sxs-lookup"><span data-stu-id="99d69-153">Instead, those data items are owned by the catalog and pricing microservices.</span></span> <span data-ttu-id="99d69-154">Dies stellt ein Problem dar.</span><span class="sxs-lookup"><span data-stu-id="99d69-154">This presents a problem.</span></span> <span data-ttu-id="99d69-155">Wie kann der Warenkorb-microservice dem Einkaufskorb des Benutzers ein Produkt hinzufügen, wenn es keine Produkt-oder Preisdaten in der Datenbank hat?</span><span class="sxs-lookup"><span data-stu-id="99d69-155">How can the shopping basket microservice add a product to the user's shopping basket when it doesn't have product nor pricing data in its database?</span></span>

<span data-ttu-id="99d69-156">Eine in Kapitel 4 erörterte Option ist ein [direkter http-Rückruf](service-to-service-communication.md#queries) aus dem Warenkorb zum Katalog und den Preisen von microservices.</span><span class="sxs-lookup"><span data-stu-id="99d69-156">One option discussed in Chapter 4 is a [direct HTTP call](service-to-service-communication.md#queries) from the shopping basket to the catalog and pricing microservices.</span></span> <span data-ttu-id="99d69-157">In Kapitel 4 sagten wir jedoch, dass synchrone http-Aufrufe *mehrere* mikrodienste durchgeführt haben, um ihre Autonomie zu verringern und die Vorteile der Architektur zu verringern.</span><span class="sxs-lookup"><span data-stu-id="99d69-157">However, in chapter 4, we said synchronous HTTP calls *couple* microservices together, reducing their autonomy and diminishing their architectural benefits.</span></span>

<span data-ttu-id="99d69-158">Wir könnten auch ein Anforderungs-Antwort-Muster mit separaten eingehenden und ausgehenden Warteschlangen für jeden Dienst implementieren.</span><span class="sxs-lookup"><span data-stu-id="99d69-158">We could also implement a request-reply pattern with separate inbound and outbound queues for each service.</span></span> <span data-ttu-id="99d69-159">Dieses Muster ist jedoch kompliziert und erfordert, dass Sie Anforderungs-und Antwort Nachrichten korrelieren.</span><span class="sxs-lookup"><span data-stu-id="99d69-159">However, this pattern is complicated and requires plumbing to correlate request and response messages.</span></span>
<span data-ttu-id="99d69-160">Während die Back-End-Webdienst Aufrufe abgekoppelt werden, muss der aufrufende Dienst trotzdem synchron auf den Abschluss des Aufrufs warten.</span><span class="sxs-lookup"><span data-stu-id="99d69-160">While it does decouple the backend microservice calls, the calling service must still synchronously wait for the call to complete.</span></span> <span data-ttu-id="99d69-161">Netzwerk Überlastung, vorübergehende Fehler oder ein überladener mikrodienst und können zu Fehlern mit langer Ausführungszeit und sogar zu Fehlern führen.</span><span class="sxs-lookup"><span data-stu-id="99d69-161">Network congestion, transient faults, or an overloaded microservice and can result in long-running and even failed operations.</span></span>

<span data-ttu-id="99d69-162">Stattdessen ist ein häufig akzeptiertes Muster zum Entfernen von Dienst übergreifenden Abhängigkeiten das [materialisierte Ansichts Muster](/azure/architecture/patterns/materialized-view), das in Abbildung 5-4 dargestellt wird.</span><span class="sxs-lookup"><span data-stu-id="99d69-162">Instead, a widely accepted pattern for removing cross-service dependencies is the [Materialized View Pattern](/azure/architecture/patterns/materialized-view), shown in Figure 5-4.</span></span>

![Muster für materialisierte Sichten](./media/materialized-view-pattern.png)

<span data-ttu-id="99d69-164">**Abbildung 5-4**.</span><span class="sxs-lookup"><span data-stu-id="99d69-164">**Figure 5-4**.</span></span> <span data-ttu-id="99d69-165">Muster für materialisierte Sichten</span><span class="sxs-lookup"><span data-stu-id="99d69-165">Materialized View Pattern</span></span>

<span data-ttu-id="99d69-166">Mit diesem Muster platzieren Sie eine lokale Datentabelle (als *Lese Modell*bezeichnet) im Warenkorb-Dienst.</span><span class="sxs-lookup"><span data-stu-id="99d69-166">With this pattern, you place a local data table (known as a *read model*) in the shopping basket service.</span></span> <span data-ttu-id="99d69-167">Diese Tabelle enthält eine denormalisierte Kopie der Daten, die vom Produkt und den Preisen für die Preise benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-167">This table contains a denormalized copy of the data needed from the product and pricing microservices.</span></span> <span data-ttu-id="99d69-168">Wenn die Daten direkt in den Warenkorb-microservice kopiert werden, entfällt der Bedarf an teuren Dienst übergreifenden aufrufen.</span><span class="sxs-lookup"><span data-stu-id="99d69-168">Copying the data directly into the shopping basket microservice eliminates the need for expensive cross-service calls.</span></span> <span data-ttu-id="99d69-169">Mit den lokalen Daten für den Dienst verbessern Sie die Reaktionszeit und die Zuverlässigkeit des Dienstanbieter.</span><span class="sxs-lookup"><span data-stu-id="99d69-169">With the data local to the service, you improve the service's response time and reliability.</span></span> <span data-ttu-id="99d69-170">Außerdem sorgt eine eigene Kopie der Daten für den waren Korb Dienst.</span><span class="sxs-lookup"><span data-stu-id="99d69-170">Additionally, having its own copy of the data makes the shopping basket service more resilient.</span></span> <span data-ttu-id="99d69-171">Wenn der Katalog Dienst nicht verfügbar sein sollte, wirkt sich dies nicht direkt auf den Warenkorb-Dienst aus.</span><span class="sxs-lookup"><span data-stu-id="99d69-171">If the catalog service should become unavailable, it wouldn't directly impact the shopping basket service.</span></span> <span data-ttu-id="99d69-172">Der Warenkorb kann mit den Daten aus seinem eigenen Geschäft fortgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-172">The shopping basket can continue operating with the data from its own store.</span></span>

<span data-ttu-id="99d69-173">Der catch mit diesem Ansatz besteht darin, dass Sie jetzt doppelte Daten in Ihrem System haben.</span><span class="sxs-lookup"><span data-stu-id="99d69-173">The catch with this approach is that you now have duplicate data in your system.</span></span> <span data-ttu-id="99d69-174">Das *strategische* Duplizieren von Daten in nativen cloudsystemen ist jedoch eine bewährte Vorgehensweise, die nicht als Antimuster oder als bewährte Vorgehensweise angesehen wird.</span><span class="sxs-lookup"><span data-stu-id="99d69-174">However, *strategically* duplicating data in cloud-native systems is an established practice and not considered an anti-pattern, or bad practice.</span></span> <span data-ttu-id="99d69-175">Beachten Sie, dass *nur ein Dienst* ein DataSet besitzen und über eine Autorität verfügen kann.</span><span class="sxs-lookup"><span data-stu-id="99d69-175">Keep in mind that *one and only one service* can own a data set and have authority over it.</span></span> <span data-ttu-id="99d69-176">Sie müssen die Lese Modelle synchronisieren, wenn das Datensatz-System aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="99d69-176">You'll need to synchronize the read models when the system of record is updated.</span></span> <span data-ttu-id="99d69-177">Die Synchronisierung wird in der Regel über asynchrones Messaging mit einem [Veröffentlichungs-/abonnementmuster](service-to-service-communication.md#events)implementiert, wie in Abbildung 5,4 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="99d69-177">Synchronization is typically implemented via asynchronous messaging with a [publish/subscribe pattern](service-to-service-communication.md#events), as shown in Figure 5.4.</span></span>

## <a name="distributed-transactions"></a><span data-ttu-id="99d69-178">Verteilte Transaktionen</span><span class="sxs-lookup"><span data-stu-id="99d69-178">Distributed transactions</span></span>

<span data-ttu-id="99d69-179">Das Abfragen von Daten über mehrere mikrodienste hinweg ist schwierig, aber das Implementieren einer Transaktion über mehrere mikrodienste hinweg ist noch komplexer.</span><span class="sxs-lookup"><span data-stu-id="99d69-179">While querying data across microservices is difficult, implementing a transaction across several microservices is even more complex.</span></span> <span data-ttu-id="99d69-180">Die inhärente Herausforderung, die Datenkonsistenz über unabhängige Datenquellen in verschiedenen-Diensten hinweg aufrechtzuerhalten, kann nicht unterschätzt werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-180">The inherent challenge of maintaining data consistency across independent data sources in different microservices can't be understated.</span></span> <span data-ttu-id="99d69-181">Der Mangel an verteilten Transaktionen in cloudbasierten Anwendungen bedeutet, dass Sie verteilte Transaktionen Programm gesteuert verwalten müssen.</span><span class="sxs-lookup"><span data-stu-id="99d69-181">The lack of distributed transactions in cloud-native applications means that you must manage distributed transactions programmatically.</span></span> <span data-ttu-id="99d69-182">Sie wechseln von der Welt der *unmittelbaren Konsistenz* zu der von *letztlicher Konsistenz*.</span><span class="sxs-lookup"><span data-stu-id="99d69-182">You move from a world of *immediate consistency* to that of *eventual consistency*.</span></span>

<span data-ttu-id="99d69-183">In Abbildung 5-5 wird das Problem gezeigt.</span><span class="sxs-lookup"><span data-stu-id="99d69-183">Figure 5-5 shows the problem.</span></span>

![Transaktion in Saga-Muster](./media/saga-transaction-operation.png)

<span data-ttu-id="99d69-185">**Abbildung 5-5**.</span><span class="sxs-lookup"><span data-stu-id="99d69-185">**Figure 5-5**.</span></span> <span data-ttu-id="99d69-186">Transaktionsübergreifende Implementierung einer Transaktion</span><span class="sxs-lookup"><span data-stu-id="99d69-186">Implementing a transaction across microservices</span></span>

<span data-ttu-id="99d69-187">In der obigen Abbildung nehmen fünf unabhängige-mikrodienste an einer verteilten Transaktion Teil, die eine Bestellung erstellt.</span><span class="sxs-lookup"><span data-stu-id="99d69-187">In the preceding figure, five independent microservices participate in a distributed transaction that creates an order.</span></span> <span data-ttu-id="99d69-188">Jeder-mikrodienst verwaltet seinen eigenen Datenspeicher und implementiert eine lokale Transaktion für seinen Speicher.</span><span class="sxs-lookup"><span data-stu-id="99d69-188">Each microservice maintains its own data store and implements a local transaction for its store.</span></span> <span data-ttu-id="99d69-189">Um die Reihenfolge zu erstellen, muss die lokale Transaktion für *jeden* einzelnen mikrodienst erfolgreich ausgeführt werden *, oder der* Vorgang muss abgebrochen und ein Rollback für den Vorgang ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-189">To create the order, the local transaction for *each* individual microservice must succeed, or *all* must abort and roll back the operation.</span></span> <span data-ttu-id="99d69-190">Obwohl die integrierte Transaktionsunterstützung innerhalb der einzelnen-Dienste verfügbar ist, gibt es keine Unterstützung für eine verteilte Transaktion, die sich über alle fünf Dienste erstrecken würde, um die Daten konsistent zu halten.</span><span class="sxs-lookup"><span data-stu-id="99d69-190">While built-in transactional support is available inside each of the microservices, there's no support for a distributed transaction that would span across all five services to keep data consistent.</span></span>

<span data-ttu-id="99d69-191">Stattdessen müssen Sie diese verteilte Transaktion *Programm*gesteuert erstellen.</span><span class="sxs-lookup"><span data-stu-id="99d69-191">Instead, you must construct this distributed transaction *programmatically*.</span></span>

<span data-ttu-id="99d69-192">Ein gängiges Muster für das Hinzufügen verteilter Transaktionsunterstützung ist das Saga-Muster.</span><span class="sxs-lookup"><span data-stu-id="99d69-192">A popular pattern for adding distributed transactional support is the Saga pattern.</span></span> <span data-ttu-id="99d69-193">Sie wird implementiert, indem lokale Transaktionen Programm gesteuert gruppiert und nacheinander nacheinander aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-193">It's implemented by grouping local transactions together programmatically and sequentially invoking each one.</span></span> <span data-ttu-id="99d69-194">Wenn eine der lokalen Transaktionen fehlschlägt, bricht die Saga den Vorgang ab und Ruft einen Satz [kompensierender Transaktionen](/azure/architecture/patterns/compensating-transaction)auf.</span><span class="sxs-lookup"><span data-stu-id="99d69-194">If any of the local transactions fail, the Saga aborts the operation and invokes a set of [compensating transactions](/azure/architecture/patterns/compensating-transaction).</span></span> <span data-ttu-id="99d69-195">Die kompensierenden Transaktionen machen die von den vorangehenden lokalen Transaktionen vorgenommenen Änderungen rückgängig und stellen Datenkonsistenz wieder her.</span><span class="sxs-lookup"><span data-stu-id="99d69-195">The compensating transactions undo the changes made by the preceding local transactions and restore data consistency.</span></span> <span data-ttu-id="99d69-196">In Abbildung 5-6 wird eine Transaktion mit dem Muster "Saga" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="99d69-196">Figure 5-6 shows a failed transaction with the Saga pattern.</span></span>

![Rollback im Saga-Muster](./media/saga-rollback-operation.png)

<span data-ttu-id="99d69-198">**Abbildung 5–6**.</span><span class="sxs-lookup"><span data-stu-id="99d69-198">**Figure 5-6**.</span></span> <span data-ttu-id="99d69-199">Ausführen eines Rollbacks für eine Transaktion</span><span class="sxs-lookup"><span data-stu-id="99d69-199">Rolling back a transaction</span></span>

<span data-ttu-id="99d69-200">In der obigen Abbildung ist der Vorgang zum *Aktualisieren des Inventars* im Inventur-mikroservice fehlgeschlagen.</span><span class="sxs-lookup"><span data-stu-id="99d69-200">In the previous figure, the *Update Inventory* operation has failed in the Inventory microservice.</span></span> <span data-ttu-id="99d69-201">Die Saga Ruft einen Satz kompensierender Transaktionen (in rot) auf, um die Bestands Anzahl anzupassen, die Zahlung und die Bestellung abzubrechen und die Daten für jeden Mikro Dienst wieder in einen konsistenten Zustand zu bringen.</span><span class="sxs-lookup"><span data-stu-id="99d69-201">The Saga invokes a set of compensating transactions (in red) to adjust the inventory counts, cancel the payment and the order, and return the data for each microservice back to a consistent state.</span></span>

<span data-ttu-id="99d69-202">Saga-Muster werden in der Regel als eine Reihe verwandter Ereignisse und als eine Reihe verwandter Befehle orchestriert.</span><span class="sxs-lookup"><span data-stu-id="99d69-202">Saga patterns are typically choreographed as a series of related events, or orchestrated as a set of related commands.</span></span> <span data-ttu-id="99d69-203">In Kapitel 4 wurde das dienstaggregatormuster erläutert, das als Grundlage für eine orchestrierte Saga-Implementierung dienen würde.</span><span class="sxs-lookup"><span data-stu-id="99d69-203">In Chapter 4, we discussed the service aggregator pattern that would be the foundation for an orchestrated saga implementation.</span></span> <span data-ttu-id="99d69-204">Wir haben auch erläutert, wie Sie mit Azure Service Bus und Azure Event Grid Themen, die eine Grundlage für eine choreografiert-Saga-Implementierung sind, behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-204">We also discussed eventing along with Azure Service Bus and Azure Event Grid topics that would be a foundation for a choreographed saga implementation.</span></span>

## <a name="high-volume-data"></a><span data-ttu-id="99d69-205">Daten mit hohem Volumen</span><span class="sxs-lookup"><span data-stu-id="99d69-205">High volume data</span></span>

<span data-ttu-id="99d69-206">Große cloudnative Anwendungen unterstützen häufig Datenanforderungen mit hohem Volumen.</span><span class="sxs-lookup"><span data-stu-id="99d69-206">Large cloud-native applications often support high-volume data requirements.</span></span> <span data-ttu-id="99d69-207">In diesen Szenarien können herkömmliche Daten Speicherungs Techniken zu Engpässen führen.</span><span class="sxs-lookup"><span data-stu-id="99d69-207">In these scenarios, traditional data storage techniques can cause bottlenecks.</span></span> <span data-ttu-id="99d69-208">Für komplexe Systeme, die in großem Umfang bereitgestellt werden, können sowohl Command and Query Responsibility Segregation (cqrs) als auch die Ereignis Beschaffung die Anwendungsleistung verbessern.</span><span class="sxs-lookup"><span data-stu-id="99d69-208">For complex systems that deploy on a large scale, both Command and Query Responsibility Segregation (CQRS) and Event Sourcing may improve application performance.</span></span>  

### <a name="cqrs"></a><span data-ttu-id="99d69-209">CQRS-Architektur</span><span class="sxs-lookup"><span data-stu-id="99d69-209">CQRS</span></span>

<span data-ttu-id="99d69-210">[Cqrs](/azure/architecture/patterns/cqrs)ist ein Architekturmuster, das dazu beiträgt, die Leistung, Skalierbarkeit und Sicherheit zu maximieren.</span><span class="sxs-lookup"><span data-stu-id="99d69-210">[CQRS](/azure/architecture/patterns/cqrs), is an architectural pattern that can help maximize performance, scalability, and security.</span></span> <span data-ttu-id="99d69-211">Das Muster trennt Vorgänge, die Daten aus den Vorgängen lesen, die Daten schreiben.</span><span class="sxs-lookup"><span data-stu-id="99d69-211">The pattern separates operations that read data from those operations that write data.</span></span>

<span data-ttu-id="99d69-212">In normalen Szenarien werden das gleiche Entitäts Modell und das gleiche Datenrepository-Objekt *sowohl* für Lese-als auch für Schreibvorgänge verwendet.</span><span class="sxs-lookup"><span data-stu-id="99d69-212">For normal scenarios, the same entity model and data repository object are used for *both* read and write operations.</span></span>

<span data-ttu-id="99d69-213">Ein Szenario mit hohem Datenvolumen kann jedoch von separaten Modellen und Datentabellen für Lese-und Schreibvorgänge profitieren.</span><span class="sxs-lookup"><span data-stu-id="99d69-213">However, a high volume data scenario can benefit from separate models and data tables for reads and writes.</span></span> <span data-ttu-id="99d69-214">Um die Leistung zu verbessern, könnte der Lesevorgang Abfragen für eine hochgradig denormalisierte Darstellung der Daten durchführt, um teure wiederkehrende Tabellen Joins und Tabellensperren zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="99d69-214">To improve performance, the read operation could query against a highly denormalized representation of the data to avoid expensive repetitive table joins and table locks.</span></span> <span data-ttu-id="99d69-215">Der *Schreib* Vorgang, der als *Befehl*bezeichnet wird, würde mit einer vollständig normalisierten Darstellung der Daten aktualisiert werden, die die Konsistenz gewährleisten würden.</span><span class="sxs-lookup"><span data-stu-id="99d69-215">The *write* operation, known as a *command*, would update against a fully normalized representation of the data that would guarantee consistency.</span></span> <span data-ttu-id="99d69-216">Anschließend müssen Sie einen Mechanismus implementieren, um beide Darstellungen synchron zu halten. Wenn die Schreib Tabelle geändert wird, wird in der Regel ein Ereignis veröffentlicht, das die Änderung in der Lese Tabelle repliziert.</span><span class="sxs-lookup"><span data-stu-id="99d69-216">You then need to implement a mechanism to keep both representations in sync. Typically, whenever the write table is modified, it publishes an event that replicates the modification to the read table.</span></span>

<span data-ttu-id="99d69-217">In Abbildung 5-7 wird eine Implementierung des cqrs-Musters gezeigt.</span><span class="sxs-lookup"><span data-stu-id="99d69-217">Figure 5-7 shows an implementation of the CQRS pattern.</span></span>

![Command and Query Responsibility Segregation](./media/cqrs-implementation.png)

<span data-ttu-id="99d69-219">**Abbildung 5-7**.</span><span class="sxs-lookup"><span data-stu-id="99d69-219">**Figure 5-7**.</span></span> <span data-ttu-id="99d69-220">Cqrs-Implementierung</span><span class="sxs-lookup"><span data-stu-id="99d69-220">CQRS implementation</span></span>

<span data-ttu-id="99d69-221">In der vorherigen Abbildung werden separate Befehls-und Abfrage Modelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="99d69-221">In the previous figure, separate command and query models are implemented.</span></span> <span data-ttu-id="99d69-222">Jeder Daten Schreibvorgang wird im Schreib Speicher gespeichert und dann an den Lese Speicher weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="99d69-222">Each data write operation is saved to the write store and then propagated to the read store.</span></span> <span data-ttu-id="99d69-223">Achten Sie genau darauf, wie der Daten propagierungs Prozess auf das Prinzip der [letztlichen Konsistenz](https://www.cloudcomputingpatterns.org/eventual_consistency/)angewendet wird.</span><span class="sxs-lookup"><span data-stu-id="99d69-223">Pay close attention to how the data propagation process operates on the principle of [eventual consistency](https://www.cloudcomputingpatterns.org/eventual_consistency/).</span></span> <span data-ttu-id="99d69-224">Das Lese Modell wird schließlich mit dem schreibmodell synchronisiert, es kann jedoch eine gewisse Verzögerung beim Prozess auftreten.</span><span class="sxs-lookup"><span data-stu-id="99d69-224">The read model eventually synchronizes with the write model, but there may be some lag in the process.</span></span> <span data-ttu-id="99d69-225">Im nächsten Abschnitt wird die letztliche Konsistenz erörtert.</span><span class="sxs-lookup"><span data-stu-id="99d69-225">We discuss eventual consistency in the next section.</span></span>

<span data-ttu-id="99d69-226">Diese Trennung ermöglicht die unabhängige Skalierung von Lese-und Schreibvorgängen.</span><span class="sxs-lookup"><span data-stu-id="99d69-226">This separation enables reads and writes to scale independently.</span></span> <span data-ttu-id="99d69-227">Lesevorgänge verwenden ein Schema, das für Abfragen optimiert ist, während die Schreibvorgänge ein Schema verwenden, das für Updates optimiert ist.</span><span class="sxs-lookup"><span data-stu-id="99d69-227">Read operations use a schema optimized for queries, while the writes use a schema optimized for updates.</span></span> <span data-ttu-id="99d69-228">Lese Abfragen gelten für Denormalisierte Daten, während komplexe Geschäftslogik auf das schreibmodell angewendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="99d69-228">Read queries go against denormalized data, while complex business logic can be applied to the write model.</span></span> <span data-ttu-id="99d69-229">Außerdem können Sie eine strengere Sicherheit bei Schreibvorgängen erzwingen als bei der Bereitstellung von Lesevorgängen.</span><span class="sxs-lookup"><span data-stu-id="99d69-229">As well, you might impose tighter security on write operations than those exposing reads.</span></span>

<span data-ttu-id="99d69-230">Das Implementieren von cqrs kann die Anwendungsleistung für Native Clouddienste verbessern.</span><span class="sxs-lookup"><span data-stu-id="99d69-230">Implementing CQRS can improve application performance for cloud-native services.</span></span> <span data-ttu-id="99d69-231">Dies führt jedoch zu einem komplexeren Design.</span><span class="sxs-lookup"><span data-stu-id="99d69-231">However, it does result in a more complex design.</span></span> <span data-ttu-id="99d69-232">Wenden Sie dieses Prinzip sorgfältig und strategisch auf die Abschnitte ihrer cloudanwendung an, die davon profitieren werden.</span><span class="sxs-lookup"><span data-stu-id="99d69-232">Apply this principle carefully and strategically to those sections of your cloud-native application that will benefit from it.</span></span> <span data-ttu-id="99d69-233">Weitere Informationen zu cqrs finden Sie unter Microsoft Book [.net microservices: Architecture for containerized .NET Applications](../microservices/microservice-ddd-cqrs-patterns/apply-simplified-microservice-cqrs-ddd-patterns.md).</span><span class="sxs-lookup"><span data-stu-id="99d69-233">For more on CQRS, see the Microsoft book [.NET Microservices: Architecture for Containerized .NET Applications](../microservices/microservice-ddd-cqrs-patterns/apply-simplified-microservice-cqrs-ddd-patterns.md).</span></span>

### <a name="event-sourcing"></a><span data-ttu-id="99d69-234">Ereignissourcing</span><span class="sxs-lookup"><span data-stu-id="99d69-234">Event sourcing</span></span>

<span data-ttu-id="99d69-235">Ein weiterer Ansatz zur Optimierung von Szenarien mit hohem Datenvolumen umfasst die [Ereignis Beschaffung](/azure/architecture/patterns/event-sourcing).</span><span class="sxs-lookup"><span data-stu-id="99d69-235">Another approach to optimizing high volume data scenarios involves [Event Sourcing](/azure/architecture/patterns/event-sourcing).</span></span>

<span data-ttu-id="99d69-236">Ein System speichert in der Regel den aktuellen Status einer Daten Entität.</span><span class="sxs-lookup"><span data-stu-id="99d69-236">A system typically stores the current state of a data entity.</span></span> <span data-ttu-id="99d69-237">Wenn ein Benutzer beispielsweise seine Telefonnummer ändert, wird der Kundendaten Satz mit der neuen Nummer aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="99d69-237">If a user changes their phone number, for example, the customer record is updated with the new number.</span></span> <span data-ttu-id="99d69-238">Der aktuelle Zustand einer Daten Entität ist immer bekannt, aber jedes Update überschreibt den vorherigen Zustand.</span><span class="sxs-lookup"><span data-stu-id="99d69-238">We always know the current state of a data entity, but each update overwrites the previous state.</span></span>

<span data-ttu-id="99d69-239">In den meisten Fällen funktioniert dieses Modell problemlos.</span><span class="sxs-lookup"><span data-stu-id="99d69-239">In most cases, this model works fine.</span></span> <span data-ttu-id="99d69-240">In Systemen mit hohem aufkommen kann sich der Aufwand von Transaktions Sperren und häufigen Aktualisierungs Vorgängen auf die Datenbankleistung, Reaktionsfähigkeit und die Einschränkung der Skalierbarkeit auswirken.</span><span class="sxs-lookup"><span data-stu-id="99d69-240">In high volume systems, however, overhead from transactional locking and frequent update operations can impact database performance, responsiveness, and limit scalability.</span></span>

<span data-ttu-id="99d69-241">Bei der Ereignis Beschaffung wird ein anderer Ansatz zum Erfassen von Daten gewählt.</span><span class="sxs-lookup"><span data-stu-id="99d69-241">Event Sourcing takes a different approach to capturing data.</span></span> <span data-ttu-id="99d69-242">Jeder Vorgang, der sich auf die Daten auswirkt, wird in einem Ereignisspeicher persistent gespeichert.</span><span class="sxs-lookup"><span data-stu-id="99d69-242">Each operation that affects data is persisted to an event store.</span></span> <span data-ttu-id="99d69-243">Anstatt den Status eines Datensatzes zu aktualisieren, fügen wir jede Änderung an eine sequenzielle Liste vergangener Ereignisse an, ähnlich wie der Ledger eines Buchhaltungs ers.</span><span class="sxs-lookup"><span data-stu-id="99d69-243">Instead of updating the state of a data record, we append each change to a sequential list of past events - similar to an accountant's ledger.</span></span> <span data-ttu-id="99d69-244">Der Ereignisspeicher wird das Datensatz-System für die Daten.</span><span class="sxs-lookup"><span data-stu-id="99d69-244">The Event Store becomes the system of record for the data.</span></span> <span data-ttu-id="99d69-245">Es wird verwendet, um verschiedene materialisierte Sichten innerhalb des begrenzten Kontexts eines-mikrodienstanders weiterzugeben.</span><span class="sxs-lookup"><span data-stu-id="99d69-245">It's used to propagate various materialized views within the bounded context of a microservice.</span></span> <span data-ttu-id="99d69-246">In Abbildung 5,8 wird das Muster veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="99d69-246">Figure 5.8 shows the pattern.</span></span>

![Ereignissourcing](./media/event-sourcing.png)

<span data-ttu-id="99d69-248">**Abbildung 5-8**.</span><span class="sxs-lookup"><span data-stu-id="99d69-248">**Figure 5-8**.</span></span> <span data-ttu-id="99d69-249">Ereignissourcing</span><span class="sxs-lookup"><span data-stu-id="99d69-249">Event Sourcing</span></span>

<span data-ttu-id="99d69-250">Beachten Sie in der obigen Abbildung, wie jeder Eintrag (in blau) für den Warenkorb eines Benutzers an einen zugrunde liegenden Ereignisspeicher angefügt wird.</span><span class="sxs-lookup"><span data-stu-id="99d69-250">In the previous figure, note how each entry (in blue) for a user's shopping cart is appended to an underlying event store.</span></span> <span data-ttu-id="99d69-251">In der angrenzenden materialisierten Sicht projiziert das System den aktuellen Zustand, indem er alle jedem Warenkorb zugeordneten Ereignisse wieder gibt.</span><span class="sxs-lookup"><span data-stu-id="99d69-251">In the adjoining materialized view, the system projects the current state by replaying all the events associated with each shopping cart.</span></span> <span data-ttu-id="99d69-252">Diese Ansicht bzw. das gelesene Modell wird dann wieder auf der Benutzeroberfläche verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="99d69-252">This view, or read model, is then exposed back to the UI.</span></span> <span data-ttu-id="99d69-253">Ereignisse können auch in externe Systeme und Anwendungen integriert oder abgefragt werden, um den aktuellen Zustand einer Entität zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="99d69-253">Events can also be integrated with external systems and applications or queried to determine the current state of an entity.</span></span> <span data-ttu-id="99d69-254">Bei dieser Vorgehensweise behalten Sie den Verlauf bei.</span><span class="sxs-lookup"><span data-stu-id="99d69-254">With this approach, you maintain history.</span></span> <span data-ttu-id="99d69-255">Sie wissen nicht nur den aktuellen Zustand einer Entität, sondern auch, wie Sie diesen Zustand erreicht haben.</span><span class="sxs-lookup"><span data-stu-id="99d69-255">You know not only the current state of an entity, but also how you reached this state.</span></span>

<span data-ttu-id="99d69-256">Bei der Ereignis Beschaffung wird das schreibmodell in der Regel vereinfacht.</span><span class="sxs-lookup"><span data-stu-id="99d69-256">Mechanically speaking, event sourcing simplifies the write model.</span></span> <span data-ttu-id="99d69-257">Es sind keine Updates oder Löschungen vorhanden.</span><span class="sxs-lookup"><span data-stu-id="99d69-257">There are no updates or deletes.</span></span> <span data-ttu-id="99d69-258">Das Anfügen der einzelnen Dateneinträge als unveränderliches Ereignis minimiert Konflikte, Sperren und Parallelitäts Konflikte, die relationalen Datenbanken zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="99d69-258">Appending each data entry as an immutable event minimizes contention, locking, and concurrency conflicts associated with relational databases.</span></span> <span data-ttu-id="99d69-259">Durch das Erstellen von lesemodellen mit dem Muster materialisierte Ansicht können Sie die Ansicht vom schreibmodell entkoppeln und den besten Datenspeicher auswählen, um die Anforderungen der Benutzeroberfläche Ihrer Anwendung zu optimieren.</span><span class="sxs-lookup"><span data-stu-id="99d69-259">Building read models with the materialized view pattern enables you to decouple the view from the write model and choose the best data store to optimize the needs of your application UI.</span></span>

<span data-ttu-id="99d69-260">Bei diesem Muster sollten Sie einen Datenspeicher in Erwägung gezogen, der die Ereignis Beschaffung direkt unterstützt.</span><span class="sxs-lookup"><span data-stu-id="99d69-260">For this pattern, consider a data store that directly supports event sourcing.</span></span> <span data-ttu-id="99d69-261">Azure Cosmos DB, MongoDB, Cassandra, couchdb und ravendb sind gute Kandidaten.</span><span class="sxs-lookup"><span data-stu-id="99d69-261">Azure Cosmos DB, MongoDB, Cassandra, CouchDB, and RavenDB are good candidates.</span></span>

<span data-ttu-id="99d69-262">Implementieren Sie wie bei allen Mustern und Technologien bei Bedarf strategisch und bei Bedarf.</span><span class="sxs-lookup"><span data-stu-id="99d69-262">As with all patterns and technologies, implement strategically and when needed.</span></span> <span data-ttu-id="99d69-263">Obwohl die Ereignis Beschaffung eine bessere Leistung und Skalierbarkeit bieten kann, erfolgt die Komplexität und eine Lernkurve.</span><span class="sxs-lookup"><span data-stu-id="99d69-263">While event sourcing can provide increased performance and scalability, it comes at the expense of complexity and a learning curve.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="99d69-264">[Zurück](service-mesh-communication-infrastructure.md)
>[Weiter](relational-vs-nosql-data.md)</span><span class="sxs-lookup"><span data-stu-id="99d69-264">[Previous](service-mesh-communication-infrastructure.md)
[Next](relational-vs-nosql-data.md)</span></span>
